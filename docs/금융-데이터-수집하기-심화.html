<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 금융 데이터 수집하기 (심화) | R을 이용한 퀀트 투자 포트폴리오 만들기(개정판)</title>
  <meta name="description" content="Chapter 6 금융 데이터 수집하기 (심화) | R을 이용한 퀀트 투자 포트폴리오 만들기(개정판)" />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 금융 데이터 수집하기 (심화) | R을 이용한 퀀트 투자 포트폴리오 만들기(개정판)" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="hyunyulhenry/quant_cookbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 금융 데이터 수집하기 (심화) | R을 이용한 퀀트 투자 포트폴리오 만들기(개정판)" />
  
  
  

<meta name="author" content="이현열" />


<meta name="date" content="2021-11-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="금융-데이터-수집하기-기본.html"/>
<link rel="next" href="데이터-정리하기.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet" />
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script>
<script src="libs/dygraphs-1.1.1/shapes.js"></script>
<script src="libs/moment-2.8.4/moment.js"></script>
<script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
<script src="libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script>
<script src="libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script>
<script src="libs/proj4js-2.3.15/proj4.js"></script>
<link href="libs/highcharts-8.1.2/css/motion.css" rel="stylesheet" />
<script src="libs/highcharts-8.1.2/highcharts.js"></script>
<script src="libs/highcharts-8.1.2/highcharts-3d.js"></script>
<script src="libs/highcharts-8.1.2/highcharts-more.js"></script>
<script src="libs/highcharts-8.1.2/modules/stock.js"></script>
<script src="libs/highcharts-8.1.2/modules/map.js"></script>
<script src="libs/highcharts-8.1.2/modules/annotations.js"></script>
<script src="libs/highcharts-8.1.2/modules/data.js"></script>
<script src="libs/highcharts-8.1.2/modules/drilldown.js"></script>
<script src="libs/highcharts-8.1.2/modules/item-series.js"></script>
<script src="libs/highcharts-8.1.2/modules/offline-exporting.js"></script>
<script src="libs/highcharts-8.1.2/modules/overlapping-datalabels.js"></script>
<script src="libs/highcharts-8.1.2/modules/exporting.js"></script>
<script src="libs/highcharts-8.1.2/modules/export-data.js"></script>
<script src="libs/highcharts-8.1.2/modules/funnel.js"></script>
<script src="libs/highcharts-8.1.2/modules/heatmap.js"></script>
<script src="libs/highcharts-8.1.2/modules/treemap.js"></script>
<script src="libs/highcharts-8.1.2/modules/sankey.js"></script>
<script src="libs/highcharts-8.1.2/modules/dependency-wheel.js"></script>
<script src="libs/highcharts-8.1.2/modules/organization.js"></script>
<script src="libs/highcharts-8.1.2/modules/solid-gauge.js"></script>
<script src="libs/highcharts-8.1.2/modules/streamgraph.js"></script>
<script src="libs/highcharts-8.1.2/modules/sunburst.js"></script>
<script src="libs/highcharts-8.1.2/modules/vector.js"></script>
<script src="libs/highcharts-8.1.2/modules/wordcloud.js"></script>
<script src="libs/highcharts-8.1.2/modules/xrange.js"></script>
<script src="libs/highcharts-8.1.2/modules/tilemap.js"></script>
<script src="libs/highcharts-8.1.2/modules/venn.js"></script>
<script src="libs/highcharts-8.1.2/modules/gantt.js"></script>
<script src="libs/highcharts-8.1.2/modules/timeline.js"></script>
<script src="libs/highcharts-8.1.2/modules/parallel-coordinates.js"></script>
<script src="libs/highcharts-8.1.2/modules/bullet.js"></script>
<script src="libs/highcharts-8.1.2/modules/coloraxis.js"></script>
<script src="libs/highcharts-8.1.2/modules/dumbbell.js"></script>
<script src="libs/highcharts-8.1.2/modules/lollipop.js"></script>
<script src="libs/highcharts-8.1.2/modules/series-label.js"></script>
<script src="libs/highcharts-8.1.2/plugins/motion.js"></script>
<script src="libs/highcharts-8.1.2/custom/reset.js"></script>
<script src="libs/highcharts-8.1.2/modules/boost.js"></script>
<script src="libs/highchart-binding-0.8.2/highchart.js"></script>
<script src="libs/plotly-binding-4.9.4.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R을 이용한 퀀트 투자 포트폴리오 만들기</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#지은이-소개"><i class="fa fa-check"></i>지은이 소개</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#머리말"><i class="fa fa-check"></i>머리말</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#이-책의-구성"><i class="fa fa-check"></i>이 책의 구성</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#이-책에서-다루지-않은-주제"><i class="fa fa-check"></i>이 책에서 다루지 않은 주제</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#도움이-될-만한-자료들"><i class="fa fa-check"></i>도움이 될 만한 자료들</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#이-책의-지원-페이지"><i class="fa fa-check"></i>이 책의 지원 페이지</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#종목과-관련된-유의사항"><i class="fa fa-check"></i>종목과 관련된 유의사항</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#세션정보"><i class="fa fa-check"></i>세션정보</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html"><i class="fa fa-check"></i>R 기초 배우기</a>
<ul>
<li class="chapter" data-level="0.1" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#r과-r-스튜디오-설치하기"><i class="fa fa-check"></i><b>0.1</b> R과 R 스튜디오 설치하기</a>
<ul>
<li class="chapter" data-level="0.1.1" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#r-설치하기"><i class="fa fa-check"></i><b>0.1.1</b> R 설치하기</a></li>
<li class="chapter" data-level="0.1.2" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#r-스튜디오-설치하기"><i class="fa fa-check"></i><b>0.1.2</b> R 스튜디오 설치하기</a></li>
</ul></li>
<li class="chapter" data-level="0.2" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#r-스튜디오-화면-구성"><i class="fa fa-check"></i><b>0.2</b> R 스튜디오 화면 구성</a></li>
<li class="chapter" data-level="0.3" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#r-스튜디오-설정하기"><i class="fa fa-check"></i><b>0.3</b> R 스튜디오 설정하기</a></li>
<li class="chapter" data-level="0.4" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#프로젝트-만들기"><i class="fa fa-check"></i><b>0.4</b> 프로젝트 만들기</a></li>
<li class="chapter" data-level="0.5" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#데이터-타입별-다루기"><i class="fa fa-check"></i><b>0.5</b> 데이터 타입별 다루기</a>
<ul>
<li class="chapter" data-level="0.5.1" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#숫자-형태"><i class="fa fa-check"></i><b>0.5.1</b> 숫자 형태</a></li>
<li class="chapter" data-level="0.5.2" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#문자열-형태"><i class="fa fa-check"></i><b>0.5.2</b> 문자열 형태</a></li>
<li class="chapter" data-level="0.5.3" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#날짜-형태"><i class="fa fa-check"></i><b>0.5.3</b> 날짜 형태</a></li>
</ul></li>
<li class="chapter" data-level="0.6" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#데이터-구조-다루기"><i class="fa fa-check"></i><b>0.6</b> 데이터 구조 다루기</a>
<ul>
<li class="chapter" data-level="0.6.1" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#벡터-다루기"><i class="fa fa-check"></i><b>0.6.1</b> 벡터 다루기</a></li>
<li class="chapter" data-level="0.6.2" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#리스트-다루기"><i class="fa fa-check"></i><b>0.6.2</b> 리스트 다루기</a></li>
<li class="chapter" data-level="0.6.3" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#데이터프레임-다루기"><i class="fa fa-check"></i><b>0.6.3</b> 데이터프레임 다루기</a></li>
<li class="chapter" data-level="0.6.4" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#결측치-처리하기"><i class="fa fa-check"></i><b>0.6.4</b> 결측치 처리하기</a></li>
</ul></li>
<li class="chapter" data-level="0.7" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#데이터-불러오기-및-내보내기"><i class="fa fa-check"></i><b>0.7</b> 데이터 불러오기 및 내보내기</a>
<ul>
<li class="chapter" data-level="0.7.1" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#워킹-디렉터리"><i class="fa fa-check"></i><b>0.7.1</b> 워킹 디렉터리</a></li>
<li class="chapter" data-level="0.7.2" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#csv-파일-불러오기-및-저장하기"><i class="fa fa-check"></i><b>0.7.2</b> csv 파일 불러오기 및 저장하기</a></li>
<li class="chapter" data-level="0.7.3" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#엑셀-파일-불러오기-및-저장하기"><i class="fa fa-check"></i><b>0.7.3</b> 엑셀 파일 불러오기 및 저장하기</a></li>
</ul></li>
<li class="chapter" data-level="0.8" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#효율성과-가독성-높이기"><i class="fa fa-check"></i><b>0.8</b> 효율성과 가독성 높이기</a>
<ul>
<li class="chapter" data-level="0.8.1" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#함수"><i class="fa fa-check"></i><b>0.8.1</b> 함수</a></li>
<li class="chapter" data-level="0.8.2" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#루프-구문"><i class="fa fa-check"></i><b>0.8.2</b> 루프 구문</a></li>
<li class="chapter" data-level="0.8.3" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#파이프-오퍼레이터"><i class="fa fa-check"></i><b>0.8.3</b> 파이프 오퍼레이터</a></li>
</ul></li>
<li class="chapter" data-level="0.9" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#데이터-구조-변형하기"><i class="fa fa-check"></i><b>0.9</b> 데이터 구조 변형하기</a>
<ul>
<li class="chapter" data-level="0.9.1" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#tidyr-패키지를-이용한-데이터-모양-바꾸기"><i class="fa fa-check"></i><b>0.9.1</b> <code>tidyr</code> 패키지를 이용한 데이터 모양 바꾸기</a></li>
<li class="chapter" data-level="0.9.2" data-path="r-기초-배우기.html"><a href="r-기초-배우기.html#dplyr-패키지를-이용한-데이터-변형하기"><i class="fa fa-check"></i><b>0.9.2</b> <code>dplyr</code> 패키지를 이용한 데이터 변형하기</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="퀀트-투자의-심장-데이터와-프로그래밍.html"><a href="퀀트-투자의-심장-데이터와-프로그래밍.html"><i class="fa fa-check"></i><b>1</b> 퀀트 투자의 심장: 데이터와 프로그래밍</a>
<ul>
<li class="chapter" data-level="1.1" data-path="퀀트-투자의-심장-데이터와-프로그래밍.html"><a href="퀀트-투자의-심장-데이터와-프로그래밍.html#데이터-구하기"><i class="fa fa-check"></i><b>1.1</b> 데이터 구하기</a></li>
<li class="chapter" data-level="1.2" data-path="퀀트-투자의-심장-데이터와-프로그래밍.html"><a href="퀀트-투자의-심장-데이터와-프로그래밍.html#퀀트-투자와-프로그래밍"><i class="fa fa-check"></i><b>1.2</b> 퀀트 투자와 프로그래밍</a></li>
<li class="chapter" data-level="1.3" data-path="퀀트-투자의-심장-데이터와-프로그래밍.html"><a href="퀀트-투자의-심장-데이터와-프로그래밍.html#r-프로그램"><i class="fa fa-check"></i><b>1.3</b> R 프로그램</a></li>
<li class="chapter" data-level="1.4" data-path="퀀트-투자의-심장-데이터와-프로그래밍.html"><a href="퀀트-투자의-심장-데이터와-프로그래밍.html#퀀트-투자에-유용한-r-패키지"><i class="fa fa-check"></i><b>1.4</b> 퀀트 투자에 유용한 R 패키지</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html"><i class="fa fa-check"></i><b>2</b> 크롤링을 위한 기본 지식</a>
<ul>
<li class="chapter" data-level="2.1" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#인코딩의-이해와-r에서-utf-8-설정하기"><i class="fa fa-check"></i><b>2.1</b> 인코딩의 이해와 R에서 UTF-8 설정하기</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#인간과-컴퓨터-간-번역의-시작-ascii"><i class="fa fa-check"></i><b>2.1.1</b> 인간과 컴퓨터 간 번역의 시작, ASCII</a></li>
<li class="chapter" data-level="2.1.2" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#한글-인코딩-방식의-종류"><i class="fa fa-check"></i><b>2.1.2</b> 한글 인코딩 방식의 종류</a></li>
<li class="chapter" data-level="2.1.3" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#r에서-utf-8-설정하기"><i class="fa fa-check"></i><b>2.1.3</b> R에서 UTF-8 설정하기</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#웹의-동작-방식"><i class="fa fa-check"></i><b>2.2</b> 웹의 동작 방식</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#http"><i class="fa fa-check"></i><b>2.2.1</b> HTTP</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#html과-css"><i class="fa fa-check"></i><b>2.3</b> HTML과 CSS</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#html-기본-구조"><i class="fa fa-check"></i><b>2.3.1</b> HTML 기본 구조</a></li>
<li class="chapter" data-level="2.3.2" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#태그와-속성"><i class="fa fa-check"></i><b>2.3.2</b> 태그와 속성</a></li>
<li class="chapter" data-level="2.3.3" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#h-태그와-p-태그"><i class="fa fa-check"></i><b>2.3.3</b> h 태그와 p 태그</a></li>
<li class="chapter" data-level="2.3.4" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#리스트를-나타내는-ul-태그와-ol-태그"><i class="fa fa-check"></i><b>2.3.4</b> 리스트를 나타내는 ul 태그와 ol 태그</a></li>
<li class="chapter" data-level="2.3.5" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#table-태그"><i class="fa fa-check"></i><b>2.3.5</b> table 태그</a></li>
<li class="chapter" data-level="2.3.6" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#a-태그와-img-태그-및-속성"><i class="fa fa-check"></i><b>2.3.6</b> a 태그와 img 태그 및 속성</a></li>
<li class="chapter" data-level="2.3.7" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#div-태그"><i class="fa fa-check"></i><b>2.3.7</b> div 태그</a></li>
<li class="chapter" data-level="2.3.8" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#css"><i class="fa fa-check"></i><b>2.3.8</b> CSS</a></li>
<li class="chapter" data-level="2.3.9" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#클래스와-id"><i class="fa fa-check"></i><b>2.3.9</b> 클래스와 id</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#파이프-오퍼레이터-1"><i class="fa fa-check"></i><b>2.4</b> 파이프 오퍼레이터(<code>%&gt;%</code>)</a></li>
<li class="chapter" data-level="2.5" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#오류에-대한-예외처리"><i class="fa fa-check"></i><b>2.5</b> 오류에 대한 예외처리</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html"><i class="fa fa-check"></i><b>3</b> API를 이용한 데이터 수집</a>
<ul>
<li class="chapter" data-level="3.1" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html#api를-이용한-quandl-데이터-다운로드"><i class="fa fa-check"></i><b>3.1</b> API를 이용한 Quandl 데이터 다운로드</a></li>
<li class="chapter" data-level="3.2" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html#getsymbols-함수를-이용한-api-다운로드"><i class="fa fa-check"></i><b>3.2</b> <code>getSymbols()</code> 함수를 이용한 API 다운로드</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html#주가-다운로드"><i class="fa fa-check"></i><b>3.2.1</b> 주가 다운로드</a></li>
<li class="chapter" data-level="3.2.2" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html#국내-종목-주가-다운로드"><i class="fa fa-check"></i><b>3.2.2</b> 국내 종목 주가 다운로드</a></li>
<li class="chapter" data-level="3.2.3" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html#fred-데이터-다운로드"><i class="fa fa-check"></i><b>3.2.3</b> FRED 데이터 다운로드</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html"><i class="fa fa-check"></i><b>4</b> 크롤링 이해하기</a>
<ul>
<li class="chapter" data-level="4.1" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#get과-post-방식-이해하기"><i class="fa fa-check"></i><b>4.1</b> GET과 POST 방식 이해하기</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#get-방식"><i class="fa fa-check"></i><b>4.1.1</b> GET 방식</a></li>
<li class="chapter" data-level="4.1.2" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#post-방식"><i class="fa fa-check"></i><b>4.1.2</b> POST 방식</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#크롤링-예제"><i class="fa fa-check"></i><b>4.2</b> 크롤링 예제</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#금융-속보-크롤링"><i class="fa fa-check"></i><b>4.2.1</b> 금융 속보 크롤링</a></li>
<li class="chapter" data-level="4.2.2" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#기업공시채널에서-오늘의-공시-불러오기"><i class="fa fa-check"></i><b>4.2.2</b> 기업공시채널에서 오늘의 공시 불러오기</a></li>
<li class="chapter" data-level="4.2.3" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#네이버-금융에서-주식티커-크롤링"><i class="fa fa-check"></i><b>4.2.3</b> 네이버 금융에서 주식티커 크롤링</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="금융-데이터-수집하기-기본.html"><a href="금융-데이터-수집하기-기본.html"><i class="fa fa-check"></i><b>5</b> 금융 데이터 수집하기 (기본)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="금융-데이터-수집하기-기본.html"><a href="금융-데이터-수집하기-기본.html#한국거래소의-산업별-현황-및-개별지표-크롤링"><i class="fa fa-check"></i><b>5.1</b> 한국거래소의 산업별 현황 및 개별지표 크롤링</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="금융-데이터-수집하기-기본.html"><a href="금융-데이터-수집하기-기본.html#업종분류-현황-크롤링"><i class="fa fa-check"></i><b>5.1.1</b> 업종분류 현황 크롤링</a></li>
<li class="chapter" data-level="5.1.2" data-path="금융-데이터-수집하기-기본.html"><a href="금융-데이터-수집하기-기본.html#개별종목-지표-크롤링"><i class="fa fa-check"></i><b>5.1.2</b> 개별종목 지표 크롤링</a></li>
<li class="chapter" data-level="5.1.3" data-path="금융-데이터-수집하기-기본.html"><a href="금융-데이터-수집하기-기본.html#최근-영업일-기준-데이터-받기"><i class="fa fa-check"></i><b>5.1.3</b> 최근 영업일 기준 데이터 받기</a></li>
<li class="chapter" data-level="5.1.4" data-path="금융-데이터-수집하기-기본.html"><a href="금융-데이터-수집하기-기본.html#거래소-데이터-정리하기"><i class="fa fa-check"></i><b>5.1.4</b> 거래소 데이터 정리하기</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="금융-데이터-수집하기-기본.html"><a href="금융-데이터-수집하기-기본.html#wics-기준-섹터정보-크롤링"><i class="fa fa-check"></i><b>5.2</b> WICS 기준 섹터정보 크롤링</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html"><i class="fa fa-check"></i><b>6</b> 금융 데이터 수집하기 (심화)</a>
<ul>
<li class="chapter" data-level="6.1" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#수정주가-크롤링"><i class="fa fa-check"></i><b>6.1</b> 수정주가 크롤링</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#개별종목-주가-크롤링"><i class="fa fa-check"></i><b>6.1.1</b> 개별종목 주가 크롤링</a></li>
<li class="chapter" data-level="6.1.2" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#전-종목-주가-크롤링"><i class="fa fa-check"></i><b>6.1.2</b> 전 종목 주가 크롤링</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#재무제표-및-가치지표-크롤링"><i class="fa fa-check"></i><b>6.2</b> 재무제표 및 가치지표 크롤링</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#재무제표-다운로드"><i class="fa fa-check"></i><b>6.2.1</b> 재무제표 다운로드</a></li>
<li class="chapter" data-level="6.2.2" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#가치지표-계산하기"><i class="fa fa-check"></i><b>6.2.2</b> 가치지표 계산하기</a></li>
<li class="chapter" data-level="6.2.3" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#전-종목-재무제표-및-가치지표-다운로드"><i class="fa fa-check"></i><b>6.2.3</b> 전 종목 재무제표 및 가치지표 다운로드</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#dart의-open-api를-이용한-데이터-수집하기"><i class="fa fa-check"></i><b>6.3</b> DART의 Open API를 이용한 데이터 수집하기</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#api-key발급-및-추가하기"><i class="fa fa-check"></i><b>6.3.1</b> API Key발급 및 추가하기</a></li>
<li class="chapter" data-level="6.3.2" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#고유번호-다운로드"><i class="fa fa-check"></i><b>6.3.2</b> 고유번호 다운로드</a></li>
<li class="chapter" data-level="6.3.3" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#공시검색"><i class="fa fa-check"></i><b>6.3.3</b> 공시검색</a></li>
<li class="chapter" data-level="6.3.4" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#사업보고서-주요-정보"><i class="fa fa-check"></i><b>6.3.4</b> 사업보고서 주요 정보</a></li>
<li class="chapter" data-level="6.3.5" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#상장기업-재무정보"><i class="fa fa-check"></i><b>6.3.5</b> 상장기업 재무정보</a></li>
<li class="chapter" data-level="6.3.6" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#단일회사-전체-재무제표"><i class="fa fa-check"></i><b>6.3.6</b> 단일회사 전체 재무제표</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="데이터-정리하기.html"><a href="데이터-정리하기.html"><i class="fa fa-check"></i><b>7</b> 데이터 정리하기</a>
<ul>
<li class="chapter" data-level="7.1" data-path="데이터-정리하기.html"><a href="데이터-정리하기.html#주가-정리하기"><i class="fa fa-check"></i><b>7.1</b> 주가 정리하기</a></li>
<li class="chapter" data-level="7.2" data-path="데이터-정리하기.html"><a href="데이터-정리하기.html#재무제표-정리하기"><i class="fa fa-check"></i><b>7.2</b> 재무제표 정리하기</a></li>
<li class="chapter" data-level="7.3" data-path="데이터-정리하기.html"><a href="데이터-정리하기.html#가치지표-정리하기"><i class="fa fa-check"></i><b>7.3</b> 가치지표 정리하기</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html"><i class="fa fa-check"></i><b>8</b> 데이터 분석 및 시각화하기</a>
<ul>
<li class="chapter" data-level="8.1" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#종목정보-데이터-분석"><i class="fa fa-check"></i><b>8.1</b> 종목정보 데이터 분석</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#join-데이터-합치기-1"><i class="fa fa-check"></i><b>8.1.1</b> <code>*_join</code>: 데이터 합치기</a></li>
<li class="chapter" data-level="8.1.2" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#glimpse-데이터-구조-확인하기"><i class="fa fa-check"></i><b>8.1.2</b> <code>glimpse()</code>: 데이터 구조 확인하기</a></li>
<li class="chapter" data-level="8.1.3" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#rename-열-이름-바꾸기"><i class="fa fa-check"></i><b>8.1.3</b> <code>rename()</code>: 열 이름 바꾸기</a></li>
<li class="chapter" data-level="8.1.4" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#distinct-고유한-값-확인"><i class="fa fa-check"></i><b>8.1.4</b> distinct(): 고유한 값 확인</a></li>
<li class="chapter" data-level="8.1.5" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#select-원하는-열만-선택"><i class="fa fa-check"></i><b>8.1.5</b> <code>select()</code>: 원하는 열만 선택</a></li>
<li class="chapter" data-level="8.1.6" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#mutate-열-생성-및-데이터-변형"><i class="fa fa-check"></i><b>8.1.6</b> <code>mutate()</code>: 열 생성 및 데이터 변형</a></li>
<li class="chapter" data-level="8.1.7" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#filter-조건을-충족하는-행-선택"><i class="fa fa-check"></i><b>8.1.7</b> <code>filter()</code>: 조건을 충족하는 행 선택</a></li>
<li class="chapter" data-level="8.1.8" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#summarize-요약-통곗값-계산"><i class="fa fa-check"></i><b>8.1.8</b> <code>summarize()</code>: 요약 통곗값 계산</a></li>
<li class="chapter" data-level="8.1.9" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#arrange-데이터-정렬"><i class="fa fa-check"></i><b>8.1.9</b> <code>arrange()</code>: 데이터 정렬</a></li>
<li class="chapter" data-level="8.1.10" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#row_number-순위-계산"><i class="fa fa-check"></i><b>8.1.10</b> <code>row_number()</code>: 순위 계산</a></li>
<li class="chapter" data-level="8.1.11" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#ntile-분위수-계산"><i class="fa fa-check"></i><b>8.1.11</b> <code>ntile()</code>: 분위수 계산</a></li>
<li class="chapter" data-level="8.1.12" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#group_by-그룹별로-데이터를-묶기"><i class="fa fa-check"></i><b>8.1.12</b> <code>group_by()</code>: 그룹별로 데이터를 묶기</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#ggplot-기초"><i class="fa fa-check"></i><b>8.2</b> <code>ggplot()</code> 기초</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#diamonds-데이터셋"><i class="fa fa-check"></i><b>8.2.1</b> diamonds 데이터셋</a></li>
<li class="chapter" data-level="8.2.2" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#data-aesthetics-geometrics"><i class="fa fa-check"></i><b>8.2.2</b> Data, Aesthetics, Geometrics</a></li>
<li class="chapter" data-level="8.2.3" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#facets"><i class="fa fa-check"></i><b>8.2.3</b> Facets</a></li>
<li class="chapter" data-level="8.2.4" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#statistics"><i class="fa fa-check"></i><b>8.2.4</b> Statistics</a></li>
<li class="chapter" data-level="8.2.5" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#coordinates"><i class="fa fa-check"></i><b>8.2.5</b> Coordinates</a></li>
<li class="chapter" data-level="8.2.6" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#theme"><i class="fa fa-check"></i><b>8.2.6</b> Theme</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#종목정보-시각화"><i class="fa fa-check"></i><b>8.3</b> 종목정보 시각화</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#geom_point-산점도-나타내기"><i class="fa fa-check"></i><b>8.3.1</b> <code>geom_point()</code>: 산점도 나타내기</a></li>
<li class="chapter" data-level="8.3.2" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#geom_histogram-히스토그램-나타내기"><i class="fa fa-check"></i><b>8.3.2</b> <code>geom_histogram()</code>: 히스토그램 나타내기</a></li>
<li class="chapter" data-level="8.3.3" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#geom_boxplot-박스-플롯-나타내기"><i class="fa fa-check"></i><b>8.3.3</b> <code>geom_boxplot()</code>: 박스 플롯 나타내기</a></li>
<li class="chapter" data-level="8.3.4" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#dplyr과-ggplot을-연결하여-사용하기"><i class="fa fa-check"></i><b>8.3.4</b> <code>dplyr</code>과 <code>ggplot</code>을 연결하여 사용하기</a></li>
<li class="chapter" data-level="8.3.5" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#geom_bar-막대-그래프-나타내기"><i class="fa fa-check"></i><b>8.3.5</b> <code>geom_bar()</code>: 막대 그래프 나타내기</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#주가-및-수익률-시각화"><i class="fa fa-check"></i><b>8.4</b> 주가 및 수익률 시각화</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#주가-그래프-나타내기"><i class="fa fa-check"></i><b>8.4.1</b> 주가 그래프 나타내기</a></li>
<li class="chapter" data-level="8.4.2" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#인터랙티브-그래프-나타내기"><i class="fa fa-check"></i><b>8.4.2</b> 인터랙티브 그래프 나타내기</a></li>
<li class="chapter" data-level="8.4.3" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#연도별-수익률-나타내기"><i class="fa fa-check"></i><b>8.4.3</b> 연도별 수익률 나타내기</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html"><i class="fa fa-check"></i><b>9</b> 퀀트 전략을 이용한 종목선정 (기본)</a>
<ul>
<li class="chapter" data-level="9.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#베타-이해하기"><i class="fa fa-check"></i><b>9.1</b> 베타 이해하기</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#베타-계산하기"><i class="fa fa-check"></i><b>9.1.1</b> 베타 계산하기</a></li>
<li class="chapter" data-level="9.1.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#베타-시각화"><i class="fa fa-check"></i><b>9.1.2</b> 베타 시각화</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#저변동성-전략"><i class="fa fa-check"></i><b>9.2</b> 저변동성 전략</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#저변동성-포트폴리오-구하기-일간-기준"><i class="fa fa-check"></i><b>9.2.1</b> 저변동성 포트폴리오 구하기: 일간 기준</a></li>
<li class="chapter" data-level="9.2.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#저변동성-포트폴리오-구하기-주간-기준"><i class="fa fa-check"></i><b>9.2.2</b> 저변동성 포트폴리오 구하기: 주간 기준</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#모멘텀-전략"><i class="fa fa-check"></i><b>9.3</b> 모멘텀 전략</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#모멘텀-포트폴리오-구하기-12개월-모멘텀"><i class="fa fa-check"></i><b>9.3.1</b> 모멘텀 포트폴리오 구하기: 12개월 모멘텀</a></li>
<li class="chapter" data-level="9.3.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#모멘텀-포트폴리오-구하기-위험조정-수익률"><i class="fa fa-check"></i><b>9.3.2</b> 모멘텀 포트폴리오 구하기: 위험조정 수익률</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#밸류-전략"><i class="fa fa-check"></i><b>9.4</b> 밸류 전략</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#밸류-포트폴리오-구하기-저pbr"><i class="fa fa-check"></i><b>9.4.1</b> 밸류 포트폴리오 구하기: 저PBR</a></li>
<li class="chapter" data-level="9.4.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#각-지표-결합하기"><i class="fa fa-check"></i><b>9.4.2</b> 각 지표 결합하기</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#퀄리티-전략"><i class="fa fa-check"></i><b>9.5</b> 퀄리티 전략</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#f-score"><i class="fa fa-check"></i><b>9.5.1</b> F-Score</a></li>
<li class="chapter" data-level="9.5.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#각-지표를-결합하기"><i class="fa fa-check"></i><b>9.5.2</b> 각 지표를 결합하기</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html"><i class="fa fa-check"></i><b>10</b> 퀀트 전략을 이용한 종목선정 (심화)</a>
<ul>
<li class="chapter" data-level="10.1" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#섹터-중립-포트폴리오"><i class="fa fa-check"></i><b>10.1</b> 섹터 중립 포트폴리오</a></li>
<li class="chapter" data-level="10.2" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#마법공식"><i class="fa fa-check"></i><b>10.2</b> 마법공식</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#퀄리티와-밸류-간의-관계"><i class="fa fa-check"></i><b>10.2.1</b> 퀄리티와 밸류 간의 관계</a></li>
<li class="chapter" data-level="10.2.2" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#마법공식-이해하기"><i class="fa fa-check"></i><b>10.2.2</b> 마법공식 이해하기</a></li>
<li class="chapter" data-level="10.2.3" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#마법공식-구성하기"><i class="fa fa-check"></i><b>10.2.3</b> 마법공식 구성하기</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#이상치-데이터-제거-및-팩터의-결합"><i class="fa fa-check"></i><b>10.3</b> 이상치 데이터 제거 및 팩터의 결합</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#트림trim-이상치-데이터-삭제"><i class="fa fa-check"></i><b>10.3.1</b> 트림(Trim): 이상치 데이터 삭제</a></li>
<li class="chapter" data-level="10.3.2" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#윈저라이징winsorizing-이상치-데이터-대체"><i class="fa fa-check"></i><b>10.3.2</b> 윈저라이징(Winsorizing): 이상치 데이터 대체</a></li>
<li class="chapter" data-level="10.3.3" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#팩터의-결합-방법"><i class="fa fa-check"></i><b>10.3.3</b> 팩터의 결합 방법</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#멀티팩터-포트폴리오"><i class="fa fa-check"></i><b>10.4</b> 멀티팩터 포트폴리오</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html"><i class="fa fa-check"></i><b>11</b> 포트폴리오 구성</a>
<ul>
<li class="chapter" data-level="11.1" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#최소분산-포트폴리오"><i class="fa fa-check"></i><b>11.1</b> 최소분산 포트폴리오</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#slsqp-함수를-이용한-최적화"><i class="fa fa-check"></i><b>11.1.1</b> <code>slsqp()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.1.2" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#solve.qp-함수를-이용한-최적화"><i class="fa fa-check"></i><b>11.1.2</b> <code>solve.QP()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.1.3" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#optimalportfolio-함수를-이용한-최적화"><i class="fa fa-check"></i><b>11.1.3</b> <code>optimalPortfolio()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.1.4" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#결괏값들의-비교"><i class="fa fa-check"></i><b>11.1.4</b> 결괏값들의 비교</a></li>
<li class="chapter" data-level="11.1.5" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#최소-및-최대-투자비중-제약조건"><i class="fa fa-check"></i><b>11.1.5</b> 최소 및 최대 투자비중 제약조건</a></li>
<li class="chapter" data-level="11.1.6" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#각-자산별-제약조건의-추가"><i class="fa fa-check"></i><b>11.1.6</b> 각 자산별 제약조건의 추가</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#최대분산효과-포트폴리오"><i class="fa fa-check"></i><b>11.2</b> 최대분산효과 포트폴리오</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#solve.qp-함수를-이용한-최적화-1"><i class="fa fa-check"></i><b>11.2.1</b> <code>solve.QP()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.2.2" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#optimalportfolio-함수를-이용한-최적화-1"><i class="fa fa-check"></i><b>11.2.2</b> <code>optimalPortfolio()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.2.3" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#최소-및-최대-투자비중-제약조건-1"><i class="fa fa-check"></i><b>11.2.3</b> 최소 및 최대 투자비중 제약조건</a></li>
<li class="chapter" data-level="11.2.4" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#각-자산-별-제약조건의-추가"><i class="fa fa-check"></i><b>11.2.4</b> 각 자산 별 제약조건의 추가</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#위험균형-포트폴리오"><i class="fa fa-check"></i><b>11.3</b> 위험균형 포트폴리오</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#주식-60와-채권-40-포트폴리오의-위험기여도"><i class="fa fa-check"></i><b>11.3.1</b> 주식 60%와 채권 40% 포트폴리오의 위험기여도</a></li>
<li class="chapter" data-level="11.3.2" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#rp-함수를-이용한-최적화"><i class="fa fa-check"></i><b>11.3.2</b> <code>rp()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.3.3" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#위험예산-포트폴리오"><i class="fa fa-check"></i><b>11.3.3</b> 위험예산 포트폴리오</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#인덱스-포트폴리오-구성하기"><i class="fa fa-check"></i><b>11.4</b> 인덱스 포트폴리오 구성하기</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#시가총액비중-계산하기"><i class="fa fa-check"></i><b>11.4.1</b> 시가총액비중 계산하기</a></li>
<li class="chapter" data-level="11.4.2" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#인덱스-포트폴리오-복제하기"><i class="fa fa-check"></i><b>11.4.2</b> 인덱스 포트폴리오 복제하기</a></li>
<li class="chapter" data-level="11.4.3" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#팩터를-이용한-인핸스드-포트폴리오-구성하기"><i class="fa fa-check"></i><b>11.4.3</b> 팩터를 이용한 인핸스드 포트폴리오 구성하기</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html"><i class="fa fa-check"></i><b>12</b> 포트폴리오 백테스트</a>
<ul>
<li class="chapter" data-level="12.1" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#return.portfolio-함수"><i class="fa fa-check"></i><b>12.1</b> <code>Return.Portfolio()</code> 함수</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#인자-목록-살펴보기"><i class="fa fa-check"></i><b>12.1.1</b> 인자 목록 살펴보기</a></li>
<li class="chapter" data-level="12.1.2" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#출력값-살펴보기"><i class="fa fa-check"></i><b>12.1.2</b> 출력값 살펴보기</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#전통적인-60대-40-포트폴리오-백테스트"><i class="fa fa-check"></i><b>12.2</b> 전통적인 60대 40 포트폴리오 백테스트</a></li>
<li class="chapter" data-level="12.3" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#시점-선택-전략-백테스트"><i class="fa fa-check"></i><b>12.3</b> 시점 선택 전략 백테스트</a></li>
<li class="chapter" data-level="12.4" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#동적-자산배분-백테스트"><i class="fa fa-check"></i><b>12.4</b> 동적 자산배분 백테스트</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html"><i class="fa fa-check"></i><b>13</b> 성과 및 위험 평가</a>
<ul>
<li class="chapter" data-level="13.1" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#결과-측정-지표"><i class="fa fa-check"></i><b>13.1</b> 결과 측정 지표</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#수익률-및-변동성"><i class="fa fa-check"></i><b>13.1.1</b> 수익률 및 변동성</a></li>
<li class="chapter" data-level="13.1.2" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#낙폭과-최대낙폭"><i class="fa fa-check"></i><b>13.1.2</b> 낙폭과 최대낙폭</a></li>
<li class="chapter" data-level="13.1.3" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#연도별-수익률"><i class="fa fa-check"></i><b>13.1.3</b> 연도별 수익률</a></li>
<li class="chapter" data-level="13.1.4" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#승률-및-롤링-윈도우-값"><i class="fa fa-check"></i><b>13.1.4</b> 승률 및 롤링 윈도우 값</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#팩터-회귀분석-및-테이블로-나타내기"><i class="fa fa-check"></i><b>13.2</b> 팩터 회귀분석 및 테이블로 나타내기</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="http://www.yes24.com/Product/Goods/97163849" target="blank">책 구입하러 가기</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R을 이용한 퀀트 투자 포트폴리오 만들기(개정판)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="금융-데이터-수집하기-심화" class="section level1" number="6">
<h1><span class="header-section-number">Chapter 6</span> 금융 데이터 수집하기 (심화)</h1>
<p>지난 CHAPTER에서 수집한 주식티커를 바탕으로 이번 CHAPTER에서는 퀀트 투자의 핵심 자료인 수정주가, 재무제표, 가치지표를 크롤링하는 방법을 알아보겠습니다.</p>
<div id="수정주가-크롤링" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> 수정주가 크롤링</h2>
<p>주가 데이터는 투자를 함에 있어 반드시 필요한 데이터이며, 인터넷에서 주가를 수집할 수 있는 방법은 매우 많습니다. 먼저 API를 이용한 데이터 수집에서 살펴본 것과 같이, <code>getSymbols()</code> 함수를 이용해 데이터를 받을 수 있습니다. 그러나 야후 파이낸스에서 제공하는 데이터 중 미국 주가는 이상 없이 다운로드되지만, 국내 중소형주는 주가가 없는 경우가 있습니다.</p>
<p>또한 단순 주가를 구할 수 있는 방법은 많지만, 투자에 필요한 수정주가를 구할 수 있는 방법은 찾기 힘듭니다. 다행히 네이버 금융에서 제공하는 정보를 통해 모든 종목의 수정주가를 매우 손쉽게 구할 수 있습니다.</p>
<div id="개별종목-주가-크롤링" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> 개별종목 주가 크롤링</h3>
<p>먼저 네이버 금융에서 특정종목(예: 삼성전자)의 [차트] 탭<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a>을 선택합니다. 해당 차트는 주가 데이터를 받아 그래프를 그려주는 형태입니다. 따라서 해당 데이터가 어디에서 오는지 알기 위해 개발자 도구 화면을 이용합니다.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-285"></span>
<img src="images/crawl_practice_price2.png" alt="네이버금융 차트의 통신기록" width="100%" />
<p class="caption">
그림 6.1: 네이버금융 차트의 통신기록
</p>
</div>
<p>화면을 연 상태에서 [일] 탭을 선택하면 나오는 항목 중 가장 상단 항목의 Request URL이 주가 데이터를 요청하는 주소입니다. 해당 URL에 접속해보겠습니다.</p>
<pre><code>URL: https://fchart.stock.naver.com/siseJson.nhn?symbol=005930&amp;requestType=1&amp;startTime=20191117&amp;endTime=20210124&amp;timeframe=day</code></pre>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-286"></span>
<img src="images/crawl_practice_price3.png" alt="주가 데이터 페이지" width="100%" />
<p class="caption">
그림 6.2: 주가 데이터 페이지
</p>
</div>
<p>각 날짜별로 시가, 고가, 저가, 종가, 거래량, 외국인소지율이 있으며, 주가는 모두 수정주가 기준입니다.</p>
<p>URL에서 symbol= 뒤에 6자리 티커만 변경하면 해당 종목의 주가 데이터가 있는 페이지로 이동할 수 있으며, 이를 통해 우리가 원하는 모든 종목의 주가 데이터를 크롤링할 수 있습니다. 또한 startTime= 에는 시작일자를, endTime= 에는 종료일자를 입력하여 원하는 기간 만큼의 데이터를 받을 수도 있습니다.</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="금융-데이터-수집하기-심화.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb447-2"><a href="금융-데이터-수집하기-심화.html#cb447-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-3"><a href="금융-데이터-수집하기-심화.html#cb447-3" aria-hidden="true" tabindex="-1"></a>KOR_ticker <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&#39;data/KOR_ticker.csv&#39;</span>, <span class="at">row.names =</span> <span class="dv">1</span>)</span>
<span id="cb447-4"><a href="금융-데이터-수집하기-심화.html#cb447-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(KOR_ticker<span class="sc">$</span><span class="st">&#39;종목코드&#39;</span>[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] 5930</code></pre>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="금융-데이터-수집하기-심화.html#cb449-1" aria-hidden="true" tabindex="-1"></a>KOR_ticker<span class="sc">$</span><span class="st">&#39;종목코드&#39;</span> <span class="ot">=</span></span>
<span id="cb449-2"><a href="금융-데이터-수집하기-심화.html#cb449-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_pad</span>(KOR_ticker<span class="sc">$</span><span class="st">&#39;종목코드&#39;</span>, <span class="dv">6</span>, <span class="at">side =</span> <span class="fu">c</span>(<span class="st">&#39;left&#39;</span>), <span class="at">pad =</span> <span class="st">&#39;0&#39;</span>)</span></code></pre></div>
<p>먼저 저장해두었던 티커 항목의 csv 파일을 불러옵니다. 종목코드를 살펴보면 005930이어야 할 삼성전자의 티커가 5930으로 입력되어 있습니다. 이는 파일을 불러오는 과정에서 0으로 시작하는 숫자들이 지워졌기 때문입니다. stringr 패키지의 <code>str_pad()</code> 함수를 사용해 6자리가 되지 않는 문자는 왼쪽에 0을 추가해 강제로 6자리로 만들어주도록 합니다.</p>
<p>다음은 첫 번째 종목인 삼성전자의 주가를 크롤링한 후 가공하는 방법입니다.</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="금융-데이터-수집하기-심화.html#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb450-2"><a href="금융-데이터-수집하기-심화.html#cb450-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-3"><a href="금융-데이터-수집하기-심화.html#cb450-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">dir.exists</span>(<span class="st">&#39;data/KOR_price&#39;</span>), <span class="cn">FALSE</span>,</span>
<span id="cb450-4"><a href="금융-데이터-수집하기-심화.html#cb450-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">dir.create</span>(<span class="st">&#39;data/KOR_price&#39;</span>))</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="금융-데이터-수집하기-심화.html#cb452-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb452-2"><a href="금융-데이터-수집하기-심화.html#cb452-2" aria-hidden="true" tabindex="-1"></a>name <span class="ot">=</span> KOR_ticker<span class="sc">$</span><span class="st">&#39;종목코드&#39;</span>[i]</span>
<span id="cb452-3"><a href="금융-데이터-수집하기-심화.html#cb452-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-4"><a href="금융-데이터-수집하기-심화.html#cb452-4" aria-hidden="true" tabindex="-1"></a>price <span class="ot">=</span> <span class="fu">xts</span>(<span class="cn">NA</span>, <span class="at">order.by =</span> <span class="fu">Sys.Date</span>())</span>
<span id="cb452-5"><a href="금융-데이터-수집하기-심화.html#cb452-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(price)</span></code></pre></div>
<pre><code>##            [,1]
## 2021-11-05   NA</code></pre>
<ol style="list-style-type: decimal">
<li>data 폴더 내에 KOR_price 폴더를 생성합니다.</li>
<li>i = 1을 입력합니다. 향후 for loop 구문을 통해 i 값만 변경하면 모든 종목의 주가를 다운로드할 수 있습니다.</li>
<li>name에 해당 티커를 입력합니다.</li>
<li><code>xts()</code> 함수를 이용해 빈 시계열 데이터를 생성하며, 인덱스는 <code>Sys.Date()</code>를 통해 현재 날짜를 입력합니다.</li>
</ol>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="금융-데이터-수집하기-심화.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb454-2"><a href="금융-데이터-수집하기-심화.html#cb454-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb454-3"><a href="금융-데이터-수집하기-심화.html#cb454-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb454-4"><a href="금융-데이터-수집하기-심화.html#cb454-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb454-5"><a href="금융-데이터-수집하기-심화.html#cb454-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb454-6"><a href="금융-데이터-수집하기-심화.html#cb454-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-7"><a href="금융-데이터-수집하기-심화.html#cb454-7" aria-hidden="true" tabindex="-1"></a>from <span class="ot">=</span> (<span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="fu">years</span>(<span class="dv">3</span>)) <span class="sc">%&gt;%</span> <span class="fu">str_remove_all</span>(<span class="st">&#39;-&#39;</span>)</span>
<span id="cb454-8"><a href="금융-데이터-수집하기-심화.html#cb454-8" aria-hidden="true" tabindex="-1"></a>to <span class="ot">=</span> <span class="fu">Sys.Date</span>() <span class="sc">%&gt;%</span> <span class="fu">str_remove_all</span>(<span class="st">&#39;-&#39;</span>)</span>
<span id="cb454-9"><a href="금융-데이터-수집하기-심화.html#cb454-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-10"><a href="금융-데이터-수집하기-심화.html#cb454-10" aria-hidden="true" tabindex="-1"></a>url <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&#39;https://fchart.stock.naver.com/siseJson.nhn?symbol=&#39;</span>, name,</span>
<span id="cb454-11"><a href="금융-데이터-수집하기-심화.html#cb454-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;&amp;requestType=1&amp;startTime=&#39;</span>, from, <span class="st">&#39;&amp;endTime=&#39;</span>, to, <span class="st">&#39;&amp;timeframe=day&#39;</span>)</span>
<span id="cb454-12"><a href="금융-데이터-수집하기-심화.html#cb454-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-13"><a href="금융-데이터-수집하기-심화.html#cb454-13" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">GET</span>(url)</span>
<span id="cb454-14"><a href="금융-데이터-수집하기-심화.html#cb454-14" aria-hidden="true" tabindex="-1"></a>data_html <span class="ot">=</span> data <span class="sc">%&gt;%</span> read_html <span class="sc">%&gt;%</span></span>
<span id="cb454-15"><a href="금융-데이터-수집하기-심화.html#cb454-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() <span class="sc">%&gt;%</span></span>
<span id="cb454-16"><a href="금융-데이터-수집하기-심화.html#cb454-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>()</span>
<span id="cb454-17"><a href="금융-데이터-수집하기-심화.html#cb454-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-18"><a href="금융-데이터-수집하기-심화.html#cb454-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data_html)</span></code></pre></div>
<pre><code>## # A tibble: 743 x 8
##    `[[&#39;날짜&#39;`      `&#39;시가&#39;` `&#39;고가&#39;` `&#39;저가&#39;` `&#39;종가&#39;` `&#39;거래량&#39;` `&#39;외국인소진율&#39;~
##    &lt;chr&gt;              &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;           
##  1 &quot;[\&quot;20181105\&quot;&quot;    43750    43800    42900    43800    9426777 52.32]          
##  2 &quot;[\&quot;20181106\&quot;&quot;    43750    43800    42950    43750    7713625 52.32]          
##  3 &quot;[\&quot;20181107\&quot;&quot;    43600    44500    43400    44000   11553998 52.33]          
##  4 &quot;[\&quot;20181108\&quot;&quot;    44900    45050    44050    44050   12617397 52.35]          
##  5 &quot;[\&quot;20181109\&quot;&quot;    44450    44850    43900    44300    7318500 52.37]          
##  6 &quot;[\&quot;20181112\&quot;&quot;    43850    45250    43700    45200    8552566 52.4]           
##  7 &quot;[\&quot;20181113\&quot;&quot;    43900    44500    43400    44500    9311126 52.35]          
##  8 &quot;[\&quot;20181114\&quot;&quot;    44500    44500    43800    44100    6783344 52.33]          
##  9 &quot;[\&quot;20181115\&quot;&quot;    44050    44350    43500    44250    5864067 52.32]          
## 10 &quot;[\&quot;20181116\&quot;&quot;    44600    44750    43700    44000    7777124 52.32]          
## # ... with 733 more rows, and 1 more variable: ...8 &lt;lgl&gt;</code></pre>
<ol style="list-style-type: decimal">
<li>먼저 시작일(from)과 종료일(to)에 해당하는 날짜를 입력합니다. <code>Sys.Date()</code>를 통해 오늘 날짜를 불러온 후, 시작일은 <code>years()</code> 함수를 이용해 3년을 빼줍니다. (본인이 원하는 기간 만큼을 빼주면 됩니다.) 그 후 <code>str_remove_all()</code> 함수를 이용해 <strong>-</strong> 부분을 제거해 yyyymmdd 형식을 만들어 줍니다.</li>
<li><code>paste0()</code> 함수를 이용해 원하는 종목의 url을 생성합니다. url 중 티커에 해당하는 6자리 부분에 위에서 입력한 name을 설정합니다.</li>
<li><code>GET()</code> 함수를 통해 페이지의 데이터를 불러옵니다.</li>
<li><code>read_html()</code> 함수를 통해 HTML 정보를 읽어옵니다.</li>
<li><code>html_text()</code> 함수를 통해 텍스트 데이터만을 추출합니다.</li>
<li><code>read_csv()</code> 함수로 csv 형태의 데이터를 불러옵니다.</li>
</ol>
<p>결과적으로 날짜 및 주가, 거래량, 외국인소진율 데이터가 추출됩니다. 우리에게 필요한 날짜와 종가에 해당하는 열만 선택하고, 클렌징 작업을 해주도록 하겠습니다.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="금융-데이터-수집하기-심화.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timetk)</span>
<span id="cb456-2"><a href="금융-데이터-수집하기-심화.html#cb456-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-3"><a href="금융-데이터-수집하기-심화.html#cb456-3" aria-hidden="true" tabindex="-1"></a>price <span class="ot">=</span> data_html[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)]</span>
<span id="cb456-4"><a href="금융-데이터-수집하기-심화.html#cb456-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(price) <span class="ot">=</span> (<span class="fu">c</span>(<span class="st">&#39;Date&#39;</span>, <span class="st">&#39;Price&#39;</span>))</span>
<span id="cb456-5"><a href="금융-데이터-수집하기-심화.html#cb456-5" aria-hidden="true" tabindex="-1"></a>price <span class="ot">=</span> <span class="fu">na.omit</span>(price)</span>
<span id="cb456-6"><a href="금융-데이터-수집하기-심화.html#cb456-6" aria-hidden="true" tabindex="-1"></a>price<span class="sc">$</span>Date <span class="ot">=</span> <span class="fu">parse_number</span>(price<span class="sc">$</span>Date)</span>
<span id="cb456-7"><a href="금융-데이터-수집하기-심화.html#cb456-7" aria-hidden="true" tabindex="-1"></a>price<span class="sc">$</span>Date <span class="ot">=</span> <span class="fu">ymd</span>(price<span class="sc">$</span>Date)</span>
<span id="cb456-8"><a href="금융-데이터-수집하기-심화.html#cb456-8" aria-hidden="true" tabindex="-1"></a>price <span class="ot">=</span> <span class="fu">tk_xts</span>(price, <span class="at">date_var =</span> Date)</span>
<span id="cb456-9"><a href="금융-데이터-수집하기-심화.html#cb456-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-10"><a href="금융-데이터-수집하기-심화.html#cb456-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">tail</span>(price))</span></code></pre></div>
<pre><code>##            Price
## 2021-10-29 69800
## 2021-11-01 69900
## 2021-11-02 71500
## 2021-11-03 70400
## 2021-11-04 70600
## 2021-11-05 70200</code></pre>
<ol style="list-style-type: decimal">
<li>날짜에 해당하는 첫 번째 열과, 종가에 해당하는 다섯 번째 열만 선택해 저장합니다.</li>
<li>열 이름을 Date와 Price로 변경합니다.</li>
<li><code>na.omit()</code> 함수를 통해 NA 데이터를 삭제해줍니다.</li>
<li>Date 열에서 숫자만을 추출하기 위해 readr 패키지의 <code>parse_number()</code> 함수를 적용합니다. 해당 함수는 문자형 데이터에서 콤마와 같은 불필요한 문자를 제거한 후 숫자형 데이터로 변경해줍니다.</li>
<li>lubridate 패키지의 <code>ymd()</code> 함수를 이용하면 yyyymmdd 형태가 yyyy-mm-dd로 변경되며 데이터 형태 또한 Date 타입으로 변경됩니다.</li>
<li><code>timetk</code> 패키지의 <code>tk_xts()</code> 함수를 이용해 시계열 형태로 변경하며, 인덱스는 Date 열을 설정합니다. 형태를 변경한 후 해당 열은 자동으로 삭제됩니다.</li>
</ol>
<p>데이터를 확인해보면 우리에게 필요한 형태로 정리되었습니다.</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="금융-데이터-수집하기-심화.html#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">data.frame</span>(price),</span>
<span id="cb458-2"><a href="금융-데이터-수집하기-심화.html#cb458-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">paste0</span>(<span class="st">&#39;data/KOR_price/&#39;</span>, name, <span class="st">&#39;_price.csv&#39;</span>))</span></code></pre></div>
<p>마지막으로 해당 데이터를 data 폴더의 KOR_price 폴더 내에 티커_price.csv 이름으로 저장합니다.</p>
</div>
<div id="전-종목-주가-크롤링" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> 전 종목 주가 크롤링</h3>
<p>위의 코드에서 for loop 구문을 이용해 i 값만 변경해주면 모든 종목의 주가를 다운로드할 수 있습니다. 전 종목 주가를 다운로드하는 전체 코드는 다음과 같습니다.</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="금융-데이터-수집하기-심화.html#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb459-2"><a href="금융-데이터-수집하기-심화.html#cb459-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb459-3"><a href="금융-데이터-수집하기-심화.html#cb459-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb459-4"><a href="금융-데이터-수집하기-심화.html#cb459-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb459-5"><a href="금융-데이터-수집하기-심화.html#cb459-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb459-6"><a href="금융-데이터-수집하기-심화.html#cb459-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb459-7"><a href="금융-데이터-수집하기-심화.html#cb459-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timetk)</span>
<span id="cb459-8"><a href="금융-데이터-수집하기-심화.html#cb459-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-9"><a href="금융-데이터-수집하기-심화.html#cb459-9" aria-hidden="true" tabindex="-1"></a>KOR_ticker <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&#39;data/KOR_ticker.csv&#39;</span>, <span class="at">row.names =</span> <span class="dv">1</span>)</span>
<span id="cb459-10"><a href="금융-데이터-수집하기-심화.html#cb459-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(KOR_ticker<span class="sc">$</span><span class="st">&#39;종목코드&#39;</span>[<span class="dv">1</span>])</span>
<span id="cb459-11"><a href="금융-데이터-수집하기-심화.html#cb459-11" aria-hidden="true" tabindex="-1"></a>KOR_ticker<span class="sc">$</span><span class="st">&#39;종목코드&#39;</span> <span class="ot">=</span></span>
<span id="cb459-12"><a href="금융-데이터-수집하기-심화.html#cb459-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_pad</span>(KOR_ticker<span class="sc">$</span><span class="st">&#39;종목코드&#39;</span>, <span class="dv">6</span>, <span class="at">side =</span> <span class="fu">c</span>(<span class="st">&#39;left&#39;</span>), <span class="at">pad =</span> <span class="st">&#39;0&#39;</span>)</span>
<span id="cb459-13"><a href="금융-데이터-수집하기-심화.html#cb459-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-14"><a href="금융-데이터-수집하기-심화.html#cb459-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">dir.exists</span>(<span class="st">&#39;data/KOR_price&#39;</span>), <span class="cn">FALSE</span>,</span>
<span id="cb459-15"><a href="금융-데이터-수집하기-심화.html#cb459-15" aria-hidden="true" tabindex="-1"></a>       <span class="fu">dir.create</span>(<span class="st">&#39;data/KOR_price&#39;</span>))</span>
<span id="cb459-16"><a href="금융-데이터-수집하기-심화.html#cb459-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-17"><a href="금융-데이터-수집하기-심화.html#cb459-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> <span class="fu">nrow</span>(KOR_ticker) ) {</span>
<span id="cb459-18"><a href="금융-데이터-수집하기-심화.html#cb459-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb459-19"><a href="금융-데이터-수집하기-심화.html#cb459-19" aria-hidden="true" tabindex="-1"></a>  price <span class="ot">=</span> <span class="fu">xts</span>(<span class="cn">NA</span>, <span class="at">order.by =</span> <span class="fu">Sys.Date</span>()) <span class="co"># 빈 시계열 데이터 생성</span></span>
<span id="cb459-20"><a href="금융-데이터-수집하기-심화.html#cb459-20" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">=</span> KOR_ticker<span class="sc">$</span><span class="st">&#39;종목코드&#39;</span>[i] <span class="co"># 티커 부분 선택</span></span>
<span id="cb459-21"><a href="금융-데이터-수집하기-심화.html#cb459-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb459-22"><a href="금융-데이터-수집하기-심화.html#cb459-22" aria-hidden="true" tabindex="-1"></a>  from <span class="ot">=</span> (<span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="fu">years</span>(<span class="dv">3</span>)) <span class="sc">%&gt;%</span> <span class="fu">str_remove_all</span>(<span class="st">&#39;-&#39;</span>) <span class="co"># 시작일</span></span>
<span id="cb459-23"><a href="금융-데이터-수집하기-심화.html#cb459-23" aria-hidden="true" tabindex="-1"></a>  to <span class="ot">=</span> <span class="fu">Sys.Date</span>() <span class="sc">%&gt;%</span> <span class="fu">str_remove_all</span>(<span class="st">&#39;-&#39;</span>) <span class="co"># 종료일</span></span>
<span id="cb459-24"><a href="금융-데이터-수집하기-심화.html#cb459-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb459-25"><a href="금융-데이터-수집하기-심화.html#cb459-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 오류 발생 시 이를 무시하고 다음 루프로 진행</span></span>
<span id="cb459-26"><a href="금융-데이터-수집하기-심화.html#cb459-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb459-27"><a href="금융-데이터-수집하기-심화.html#cb459-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># url 생성</span></span>
<span id="cb459-28"><a href="금융-데이터-수집하기-심화.html#cb459-28" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&#39;https://fchart.stock.naver.com/siseJson.nhn?symbol=&#39;</span>, name,</span>
<span id="cb459-29"><a href="금융-데이터-수집하기-심화.html#cb459-29" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;&amp;requestType=1&amp;startTime=&#39;</span>, from, <span class="st">&#39;&amp;endTime=&#39;</span>, to, <span class="st">&#39;&amp;timeframe=day&#39;</span>)</span>
<span id="cb459-30"><a href="금융-데이터-수집하기-심화.html#cb459-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb459-31"><a href="금융-데이터-수집하기-심화.html#cb459-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 이 후 과정은 위와 동일함</span></span>
<span id="cb459-32"><a href="금융-데이터-수집하기-심화.html#cb459-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 데이터 다운로드</span></span>
<span id="cb459-33"><a href="금융-데이터-수집하기-심화.html#cb459-33" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">=</span> <span class="fu">GET</span>(url)</span>
<span id="cb459-34"><a href="금융-데이터-수집하기-심화.html#cb459-34" aria-hidden="true" tabindex="-1"></a>    data_html <span class="ot">=</span> data <span class="sc">%&gt;%</span> read_html <span class="sc">%&gt;%</span></span>
<span id="cb459-35"><a href="금융-데이터-수집하기-심화.html#cb459-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_text</span>() <span class="sc">%&gt;%</span></span>
<span id="cb459-36"><a href="금융-데이터-수집하기-심화.html#cb459-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_csv</span>()</span>
<span id="cb459-37"><a href="금융-데이터-수집하기-심화.html#cb459-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb459-38"><a href="금융-데이터-수집하기-심화.html#cb459-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 필요한 열만 선택 후 클렌징</span></span>
<span id="cb459-39"><a href="금융-데이터-수집하기-심화.html#cb459-39" aria-hidden="true" tabindex="-1"></a>    price <span class="ot">=</span> data_html[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)]</span>
<span id="cb459-40"><a href="금융-데이터-수집하기-심화.html#cb459-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(price) <span class="ot">=</span> (<span class="fu">c</span>(<span class="st">&#39;Date&#39;</span>, <span class="st">&#39;Price&#39;</span>))</span>
<span id="cb459-41"><a href="금융-데이터-수집하기-심화.html#cb459-41" aria-hidden="true" tabindex="-1"></a>    price <span class="ot">=</span> <span class="fu">na.omit</span>(price)</span>
<span id="cb459-42"><a href="금융-데이터-수집하기-심화.html#cb459-42" aria-hidden="true" tabindex="-1"></a>    price<span class="sc">$</span>Date <span class="ot">=</span> <span class="fu">parse_number</span>(price<span class="sc">$</span>Date)</span>
<span id="cb459-43"><a href="금융-데이터-수집하기-심화.html#cb459-43" aria-hidden="true" tabindex="-1"></a>    price<span class="sc">$</span>Date <span class="ot">=</span> <span class="fu">ymd</span>(price<span class="sc">$</span>Date)</span>
<span id="cb459-44"><a href="금융-데이터-수집하기-심화.html#cb459-44" aria-hidden="true" tabindex="-1"></a>    price <span class="ot">=</span> <span class="fu">tk_xts</span>(price, <span class="at">date_var =</span> Date)</span>
<span id="cb459-45"><a href="금융-데이터-수집하기-심화.html#cb459-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb459-46"><a href="금융-데이터-수집하기-심화.html#cb459-46" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb459-47"><a href="금융-데이터-수집하기-심화.html#cb459-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb459-48"><a href="금융-데이터-수집하기-심화.html#cb459-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 오류 발생시 해당 종목명을 출력하고 다음 루프로 이동</span></span>
<span id="cb459-49"><a href="금융-데이터-수집하기-심화.html#cb459-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste0</span>(<span class="st">&quot;Error in Ticker: &quot;</span>, name))</span>
<span id="cb459-50"><a href="금융-데이터-수집하기-심화.html#cb459-50" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb459-51"><a href="금융-데이터-수집하기-심화.html#cb459-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb459-52"><a href="금융-데이터-수집하기-심화.html#cb459-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 다운로드 받은 파일을 생성한 폴더 내 csv 파일로 저장</span></span>
<span id="cb459-53"><a href="금융-데이터-수집하기-심화.html#cb459-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(<span class="fu">data.frame</span>(price),</span>
<span id="cb459-54"><a href="금융-데이터-수집하기-심화.html#cb459-54" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste0</span>(<span class="st">&#39;data/KOR_price/&#39;</span>, name, <span class="st">&#39;_price.csv&#39;</span>))</span>
<span id="cb459-55"><a href="금융-데이터-수집하기-심화.html#cb459-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb459-56"><a href="금융-데이터-수집하기-심화.html#cb459-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 타임슬립 적용</span></span>
<span id="cb459-57"><a href="금융-데이터-수집하기-심화.html#cb459-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">2</span>)</span>
<span id="cb459-58"><a href="금융-데이터-수집하기-심화.html#cb459-58" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>위 코드에서 추가된 점은 다음과 같습니다. 페이지 오류, 통신 오류 등 오류가 발생할 경우 for loop 구문은 멈춰버리는데 전체 데이터를 처음부터 다시 받는 일은 매우 귀찮은 작업입니다. 따라서 <code>tryCatch()</code> 함수를 이용해 오류가 발생할 때 해당 티커를 출력한 후 다음 루프로 넘어가게 합니다.</p>
<p>또한 오류가 발생하면 <code>xts()</code> 함수를 통해 만들어둔 빈 데이터를 저장하게 됩니다. 마지막으로 무한 크롤링을 방지하기 위해 한 번의 루프가 끝날 때마다 2초의 타임슬립을 적용했습니다.</p>
<p>위 코드가 모두 돌아가는 데는 수 시간이 걸립니다. 작업이 끝난 후 data/KOR_price 폴더를 확인해보면 전 종목 주가가 csv 형태로 저장되어 있습니다.</p>
</div>
</div>
<div id="재무제표-및-가치지표-크롤링" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> 재무제표 및 가치지표 크롤링</h2>
<p>주가와 더불어 재무제표와 가치지표 역시 투자에 있어 핵심이 되는 데이터입니다. 해당 데이터 역시 여러 웹사이트에서 구할 수 있지만, 국내 데이터 제공업체인 FnGuide에서 운영하는 Company Guide 웹사이트<a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a>에서 손쉽게 구할 수 있습니다.</p>
<div id="재무제표-다운로드" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> 재무제표 다운로드</h3>
<p>먼저 개별종목의 재무제표를 탭을 선택하면 포괄손익계산서, 재무상태표, 현금흐름표 항목이 보이게 되며, 티커에 해당하는 A005930 뒤의 주소는 불필요한 내용이므로, 이를 제거한 주소로 접속합니다. A 뒤의 6자리 티커만 변경한다면 해당 종목의 재무제표 페이지로 이동하게 됩니다.</p>
<p><strong><a href="http://comp.fnguide.com/SVO2/ASP/SVD_Finance.asp?pGB=1&amp;gicode=A005930" class="uri">http://comp.fnguide.com/SVO2/ASP/SVD_Finance.asp?pGB=1&amp;gicode=A005930</a></strong></p>
<p>우리가 원하는 재무제표 항목들은 모두 테이블 형태로 제공되고 있으므로 html_table() 함수를 이용해 추출할 수 있습니다.</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="금융-데이터-수집하기-심화.html#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb460-2"><a href="금융-데이터-수집하기-심화.html#cb460-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb460-3"><a href="금융-데이터-수집하기-심화.html#cb460-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-4"><a href="금융-데이터-수집하기-심화.html#cb460-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">dir.exists</span>(<span class="st">&#39;data/KOR_fs&#39;</span>), <span class="cn">FALSE</span>,</span>
<span id="cb460-5"><a href="금융-데이터-수집하기-심화.html#cb460-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">dir.create</span>(<span class="st">&#39;data/KOR_fs&#39;</span>))</span>
<span id="cb460-6"><a href="금융-데이터-수집하기-심화.html#cb460-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-7"><a href="금융-데이터-수집하기-심화.html#cb460-7" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="st">&quot;LC_ALL&quot;</span>, <span class="st">&quot;English&quot;</span>)</span>
<span id="cb460-8"><a href="금융-데이터-수집하기-심화.html#cb460-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-9"><a href="금융-데이터-수집하기-심화.html#cb460-9" aria-hidden="true" tabindex="-1"></a>url <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&#39;http://comp.fnguide.com/SVO2/ASP/SVD_Finance.asp?pGB=1&amp;gicode=A005930&#39;</span>)</span>
<span id="cb460-10"><a href="금융-데이터-수집하기-심화.html#cb460-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-11"><a href="금융-데이터-수집하기-심화.html#cb460-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">GET</span>(url,</span>
<span id="cb460-12"><a href="금융-데이터-수집하기-심화.html#cb460-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">user_agent</span>(<span class="st">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)</span></span>
<span id="cb460-13"><a href="금융-데이터-수집하기-심화.html#cb460-13" aria-hidden="true" tabindex="-1"></a><span class="st">                      AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36&#39;</span>))</span>
<span id="cb460-14"><a href="금융-데이터-수집하기-심화.html#cb460-14" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> data <span class="sc">%&gt;%</span></span>
<span id="cb460-15"><a href="금융-데이터-수집하기-심화.html#cb460-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>() <span class="sc">%&gt;%</span></span>
<span id="cb460-16"><a href="금융-데이터-수집하기-심화.html#cb460-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>()</span>
<span id="cb460-17"><a href="금융-데이터-수집하기-심화.html#cb460-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-18"><a href="금융-데이터-수집하기-심화.html#cb460-18" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="st">&quot;LC_ALL&quot;</span>, <span class="st">&quot;Korean&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="금융-데이터-수집하기-심화.html#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(data, <span class="cf">function</span>(x) {</span>
<span id="cb461-2"><a href="금융-데이터-수집하기-심화.html#cb461-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(x, <span class="dv">3</span>)})</span></code></pre></div>
<pre><code>## [[1]]
## # A tibble: 3 x 7
##   `IFRS(연결)` `2018/12` `2019/12` `2020/12` `2021/06` 전년동기  `전년동기(%)`
##   &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;             &lt;dbl&gt;
## 1 매출액       2,437,714 2,304,009 2,368,070 1,290,601 1,082,913          19.2
## 2 매출원가     1,323,944 1,472,395 1,444,883 785,659   667,129            17.8
## 3 매출총이익   1,113,770 831,613   923,187   504,942   415,784            21.4
## 
## [[2]]
## # A tibble: 3 x 7
##   `IFRS(연결)` `2020/09` `2020/12` `2021/03` `2021/06` 전년동기 `전년동기(%)`
##   &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;            &lt;dbl&gt;
## 1 매출액       669,642   615,515   653,885   636,716   529,661           20.2
## 2 매출원가     399,705   378,049   415,000   370,659   319,062           16.2
## 3 매출총이익   269,937   237,466   238,885   266,057   210,599           26.3
## 
## [[3]]
## # A tibble: 3 x 5
##   `IFRS(연결)`                      `2018/12` `2019/12` `2020/12` `2021/06`
##   &lt;chr&gt;                             &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    
## 1 자산                              3,393,572 3,525,645 3,782,357 3,847,777
## 2 유동자산계산에 참여한 계정 펼치기 1,746,974 1,813,853 1,982,156 1,911,185
## 3 재고자산                          289,847   267,665   320,431   335,924  
## 
## [[4]]
## # A tibble: 3 x 5
##   `IFRS(연결)`                      `2020/09` `2020/12` `2021/03` `2021/06`
##   &lt;chr&gt;                             &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    
## 1 자산                              3,757,887 3,782,357 3,928,263 3,847,777
## 2 유동자산계산에 참여한 계정 펼치기 2,036,349 1,982,156 2,091,554 1,911,185
## 3 재고자산                          324,429   320,431   306,200   335,924  
## 
## [[5]]
## # A tibble: 3 x 5
##   `IFRS(연결)`                 `2018/12` `2019/12` `2020/12` `2021/06`
##   &lt;chr&gt;                        &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    
## 1 영업활동으로인한현금흐름     &quot;670,319&quot; &quot;453,829&quot; &quot;652,870&quot; &quot;258,895&quot;
## 2 당기순손익                   &quot;443,449&quot; &quot;217,389&quot; &quot;264,078&quot; &quot;167,762&quot;
## 3 법인세비용차감전계속사업이익 &quot;&quot;        &quot;&quot;        &quot;&quot;        &quot;&quot;       
## 
## [[6]]
## # A tibble: 3 x 5
##   `IFRS(연결)`                 `2020/09` `2020/12` `2021/03` `2021/06`
##   &lt;chr&gt;                        &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    
## 1 영업활동으로인한현금흐름     &quot;141,444&quot; &quot;245,146&quot; &quot;138,031&quot; &quot;120,865&quot;
## 2 당기순손익                   &quot;93,607&quot;  &quot;66,071&quot;  &quot;71,417&quot;  &quot;96,345&quot; 
## 3 법인세비용차감전계속사업이익 &quot;&quot;        &quot;&quot;        &quot;&quot;        &quot;&quot;</code></pre>
<ol style="list-style-type: decimal">
<li>data 폴더 내에 KOR_fs 폴더를 생성합니다.</li>
<li><code>Sys.setlocale()</code> 함수를 통해 로케일 언어를 English로 설정합니다.</li>
<li>url을 입력한 후 <code>GET()</code> 함수를 통해 페이지 내용을 받아오며, <code>user_agent()</code> 항목에 웹브라우저 구별을 입력해줍니다. 해당 사이트는 크롤러와 같이 정체가 불분명한 웹브라우저를 통한 접속이 막혀 있어, 마치 모질라 혹은 크롬을 통해 접속한 것 처럼 데이터를 요청합니다. 다양한 웹브라우저 리스트는 아래 링크에 나와있습니다.</li>
</ol>
<pre><code>http://www.useragentstring.com/pages/useragentstring.php</code></pre>
<ol start="4" style="list-style-type: decimal">
<li><code>read_html()</code> 함수를 통해 HTML 내용을 읽어오며, <code>html_table()</code> 함수를 통해 테이블 내용만 추출합니다.</li>
<li>로케일 언어를 다시 Korean으로 설정합니다.</li>
</ol>
<p>위의 과정을 거치면 data 변수에는 리스트 형태로 총 6개의 테이블이 들어오게 되며, 그 내용은 표 <a href="금융-데이터-수집하기-심화.html#tab:fstable">6.1</a>와 같습니다.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:fstable">표 6.1: </span>재무제표 테이블 내역
</caption>
<thead>
<tr>
<th style="text-align:center;">
순서
</th>
<th style="text-align:center;">
내용
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;font-weight: bold;color: white !important;background-color: black !important;">
1
</td>
<td style="text-align:center;width: 5cm; font-weight: bold;color: white !important;background-color: black !important;">
포괄손익계산서 (연간)
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;width: 5cm; ">
포괄손익계산서 (분기)
</td>
</tr>
<tr>
<td style="text-align:center;font-weight: bold;color: white !important;background-color: black !important;">
3
</td>
<td style="text-align:center;width: 5cm; font-weight: bold;color: white !important;background-color: black !important;">
재무상태표 (연간)
</td>
</tr>
<tr>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;width: 5cm; ">
재무상태표 (분기)
</td>
</tr>
<tr>
<td style="text-align:center;font-weight: bold;color: white !important;background-color: black !important;">
5
</td>
<td style="text-align:center;width: 5cm; font-weight: bold;color: white !important;background-color: black !important;">
현금흐름표 (연간)
</td>
</tr>
<tr>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;width: 5cm; ">
현금흐름표 (분기)
</td>
</tr>
</tbody>
</table>
<p>이 중 연간 기준 재무제표에 해당하는 첫 번째, 세 번째, 다섯 번째 테이블을 선택합니다.</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="금융-데이터-수집하기-심화.html#cb464-1" aria-hidden="true" tabindex="-1"></a>data_IS <span class="ot">=</span> data[[<span class="dv">1</span>]]</span>
<span id="cb464-2"><a href="금융-데이터-수집하기-심화.html#cb464-2" aria-hidden="true" tabindex="-1"></a>data_BS <span class="ot">=</span> data[[<span class="dv">3</span>]]</span>
<span id="cb464-3"><a href="금융-데이터-수집하기-심화.html#cb464-3" aria-hidden="true" tabindex="-1"></a>data_CF <span class="ot">=</span> data[[<span class="dv">5</span>]]</span>
<span id="cb464-4"><a href="금융-데이터-수집하기-심화.html#cb464-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb464-5"><a href="금융-데이터-수집하기-심화.html#cb464-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">names</span>(data_IS))</span></code></pre></div>
<pre><code>## [1] &quot;IFRS(연결)&quot;  &quot;2018/12&quot;     &quot;2019/12&quot;     &quot;2020/12&quot;     &quot;2021/06&quot;    
## [6] &quot;전년동기&quot;    &quot;전년동기(%)&quot;</code></pre>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="금융-데이터-수집하기-심화.html#cb466-1" aria-hidden="true" tabindex="-1"></a>data_IS <span class="ot">=</span> data_IS[, <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(data_IS)<span class="sc">-</span><span class="dv">2</span>)]</span></code></pre></div>
<p>포괄손익계산서 테이블(data_IS)에는 전년동기, 전년동기(%) 열이 있는데 통일성을 위해 해당 열을 삭제합니다. 이제 테이블을 묶은 후 클렌징하겠습니다.</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="금융-데이터-수집하기-심화.html#cb467-1" aria-hidden="true" tabindex="-1"></a>data_fs <span class="ot">=</span> <span class="fu">rbind</span>(data_IS, data_BS, data_CF) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb467-2"><a href="금융-데이터-수집하기-심화.html#cb467-2" aria-hidden="true" tabindex="-1"></a>data_fs[, <span class="dv">1</span>] <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">&#39;계산에 참여한 계정 펼치기&#39;</span>,</span>
<span id="cb467-3"><a href="금융-데이터-수집하기-심화.html#cb467-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;&#39;</span>, data_fs[, <span class="dv">1</span>])</span>
<span id="cb467-4"><a href="금융-데이터-수집하기-심화.html#cb467-4" aria-hidden="true" tabindex="-1"></a>data_fs <span class="ot">=</span> data_fs[<span class="sc">!</span><span class="fu">duplicated</span>(data_fs[, <span class="dv">1</span>]), ]</span>
<span id="cb467-5"><a href="금융-데이터-수집하기-심화.html#cb467-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-6"><a href="금융-데이터-수집하기-심화.html#cb467-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(data_fs) <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb467-7"><a href="금융-데이터-수집하기-심화.html#cb467-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(data_fs) <span class="ot">=</span> data_fs[, <span class="dv">1</span>]</span>
<span id="cb467-8"><a href="금융-데이터-수집하기-심화.html#cb467-8" aria-hidden="true" tabindex="-1"></a>data_fs[, <span class="dv">1</span>] <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb467-9"><a href="금융-데이터-수집하기-심화.html#cb467-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-10"><a href="금융-데이터-수집하기-심화.html#cb467-10" aria-hidden="true" tabindex="-1"></a>data_fs <span class="ot">=</span> data_fs[, <span class="fu">substr</span>(<span class="fu">colnames</span>(data_fs), <span class="dv">7</span>, <span class="dv">8</span>) <span class="sc">==</span> <span class="st">&#39;12&#39;</span>]</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><code>rbind()</code> 함수를 이용해 세 테이블을 행으로 묶은 후 데이터프레임 형태로 변경하여, data_fs에 저장합니다.</li>
<li>첫 번째 열인 계정명에는 ‘계산에 참여한 계정 펼치기’라는 글자가 들어간 항목이 있습니다. 이는 페이지 내에서 펼치기 역할을 하는 (+) 항목에 해당하며 <code>gsub()</code> 함수를 이용해 해당 글자를 삭제합니다.</li>
<li>중복되는 계정명이 다수 있는데 대부분 불필요한 항목입니다. <code>!duplicated()</code> 함수를 사용해 중복되지 않는 계정명만 선택합니다.</li>
<li>행 이름을 초기화한 후 첫 번째 열의 계정명을 행 이름으로 변경합니다. 그 후 첫 번째 열은 삭제합니다.</li>
<li>간혹 12월 결산법인이 아닌 종목이거나 연간 재무제표임에도 불구하고 분기 재무제표가 들어간 경우가 있습니다. 비교의 통일성을 위해 <code>substr()</code> 함수를 이용해 끝 글자가 12인 열, 즉 12월 결산 데이터만 선택합니다.</li>
</ol>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="금융-데이터-수집하기-심화.html#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(data_fs))</span></code></pre></div>
<pre><code>##                   X2018.12  X2019.12  X2020.12
## 매출액           2,437,714 2,304,009 2,368,070
## 매출원가         1,323,944 1,472,395 1,444,883
## 매출총이익       1,113,770   831,613   923,187
## 판매비와관리비     524,903   553,928   563,248
## 인건비              64,514    64,226    70,429
## 유무형자산상각비    14,477    20,408    20,857</code></pre>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="금융-데이터-수집하기-심화.html#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(data_fs, typeof)</span></code></pre></div>
<pre><code>##    X2018.12    X2019.12    X2020.12 
## &quot;character&quot; &quot;character&quot; &quot;character&quot;</code></pre>
<p>데이터를 확인해보면 연간 기준 재무제표가 정리되었습니다. 문자형 데이터이므로 숫자형으로 변경합니다.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="금융-데이터-수집하기-심화.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb472-2"><a href="금융-데이터-수집하기-심화.html#cb472-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-3"><a href="금융-데이터-수집하기-심화.html#cb472-3" aria-hidden="true" tabindex="-1"></a>data_fs <span class="ot">=</span> <span class="fu">sapply</span>(data_fs, <span class="cf">function</span>(x) {</span>
<span id="cb472-4"><a href="금융-데이터-수집하기-심화.html#cb472-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(x, <span class="st">&#39;,&#39;</span>, <span class="st">&#39;&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb472-5"><a href="금융-데이터-수집하기-심화.html#cb472-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>()</span>
<span id="cb472-6"><a href="금융-데이터-수집하기-심화.html#cb472-6" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb472-7"><a href="금융-데이터-수집하기-심화.html#cb472-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(., <span class="at">row.names =</span> <span class="fu">rownames</span>(data_fs))</span>
<span id="cb472-8"><a href="금융-데이터-수집하기-심화.html#cb472-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-9"><a href="금융-데이터-수집하기-심화.html#cb472-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(data_fs))</span></code></pre></div>
<pre><code>##                  X2018.12 X2019.12 X2020.12
## 매출액            2437714  2304009  2368070
## 매출원가          1323944  1472395  1444883
## 매출총이익        1113770   831613   923187
## 판매비와관리비     524903   553928   563248
## 인건비              64514    64226    70429
## 유무형자산상각비    14477    20408    20857</code></pre>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="금융-데이터-수집하기-심화.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(data_fs, typeof)</span></code></pre></div>
<pre><code>## X2018.12 X2019.12 X2020.12 
## &quot;double&quot; &quot;double&quot; &quot;double&quot;</code></pre>
<ol style="list-style-type: decimal">
<li><code>sapply()</code> 함수를 이용해 각 열에 stringr 패키지의 <code>str_replace_all()</code> 함수를 적용해 콤마(,)를 제거한 후 <code>as.numeric()</code> 함수를 통해 숫자형 데이터로 변경합니다.</li>
<li><code>data.frame()</code> 함수를 이용해 데이터 프레임 형태로 만들어주며, 행 이름은 기존 내용을 그대로 유지합니다.</li>
</ol>
<p>정리된 데이터를 출력해보면 문자형이던 데이터가 숫자형으로 변경되었습니다.</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="금융-데이터-수집하기-심화.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(data_fs, <span class="st">&#39;data/KOR_fs/005930_fs.csv&#39;</span>)</span></code></pre></div>
<p>data 폴더의 KOR_fs 폴더 내에 티커_fs.csv 이름으로 저장합니다.</p>
</div>
<div id="가치지표-계산하기" class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> 가치지표 계산하기</h3>
<p>위에서 구한 재무제표 데이터를 이용해 가치지표를 계산할 수 있습니다. 흔히 사용되는 가치지표는 <strong>PER, PBR, PCR, PSR</strong>이며 분자는 주가, 분모는 재무제표 데이터가 사용됩니다.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-300">표 6.2: </span>가치지표의 종류
</caption>
<thead>
<tr>
<th style="text-align:center;">
순서
</th>
<th style="text-align:center;">
분모
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
PER
</td>
<td style="text-align:center;">
Earnings (순이익)
</td>
</tr>
<tr>
<td style="text-align:center;">
PBR
</td>
<td style="text-align:center;">
Book Value (순자산)
</td>
</tr>
<tr>
<td style="text-align:center;">
PCR
</td>
<td style="text-align:center;">
Cashflow (영업활동현금흐름)
</td>
</tr>
<tr>
<td style="text-align:center;">
PSR
</td>
<td style="text-align:center;">
Sales (매출액)
</td>
</tr>
</tbody>
</table>
<p>위에서 구한 재무제표 항목에서 분모 부분에 해당하는 데이터만 선택해보겠습니다.</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="금융-데이터-수집하기-심화.html#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">dir.exists</span>(<span class="st">&#39;data/KOR_value&#39;</span>), <span class="cn">FALSE</span>,</span>
<span id="cb477-2"><a href="금융-데이터-수집하기-심화.html#cb477-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">dir.create</span>(<span class="st">&#39;data/KOR_value&#39;</span>))</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="금융-데이터-수집하기-심화.html#cb479-1" aria-hidden="true" tabindex="-1"></a>value_type <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;지배주주순이익&#39;</span>,</span>
<span id="cb479-2"><a href="금융-데이터-수집하기-심화.html#cb479-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;자본&#39;</span>,</span>
<span id="cb479-3"><a href="금융-데이터-수집하기-심화.html#cb479-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;영업활동으로인한현금흐름&#39;</span>,</span>
<span id="cb479-4"><a href="금융-데이터-수집하기-심화.html#cb479-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;매출액&#39;</span>)</span>
<span id="cb479-5"><a href="금융-데이터-수집하기-심화.html#cb479-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-6"><a href="금융-데이터-수집하기-심화.html#cb479-6" aria-hidden="true" tabindex="-1"></a>value_index <span class="ot">=</span> data_fs[<span class="fu">match</span>(value_type, <span class="fu">rownames</span>(data_fs)),</span>
<span id="cb479-7"><a href="금융-데이터-수집하기-심화.html#cb479-7" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ncol</span>(data_fs)]</span>
<span id="cb479-8"><a href="금융-데이터-수집하기-심화.html#cb479-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(value_index)</span></code></pre></div>
<pre><code>## [1]  260908 2759480  652870 2368070</code></pre>
<ol style="list-style-type: decimal">
<li>data 폴더 내에 KOR_value 폴더를 생성합니다.</li>
<li>분모에 해당하는 항목을 저장한 후 <code>match()</code> 함수를 이용해 해당 항목이 위치하는 지점을 찾습니다. <code>ncol()</code> 함수를 이용해 맨 오른쪽, 즉 최근년도 재무제표 데이터를 선택합니다.</li>
</ol>
<p>다음으로 분자 부분에 해당하는 현재 주가를 수집해야 합니다. 이 역시 Company Guide 접속 화면에서 구할 수 있습니다. 불필요한 부분을 제거한 URL은 다음과 같습니다.</p>
<p><strong><a href="http://comp.fnguide.com/SVO2/ASP/SVD_main.asp?pGB=1&amp;gicode=A005930" class="uri">http://comp.fnguide.com/SVO2/ASP/SVD_main.asp?pGB=1&amp;gicode=A005930</a></strong></p>
<p>위의 주소 역시 A 뒤의 6자리 티커만 변경하면 해당 종목의 스냅샷 페이지로 이동하게 됩니다.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-302"></span>
<img src="images/crawl_practice_comp_price.png" alt="Company Guide 스냅샷 화면" width="100%" />
<p class="caption">
그림 6.3: Company Guide 스냅샷 화면
</p>
</div>
<p>주가추이 부분에 우리가 원하는 현재 주가가 있습니다. 해당 데이터의 Xpath는 다음과 같습니다.</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb481-1"><a href="금융-데이터-수집하기-심화.html#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="er">//*[@id=&quot;svdMainChartTxt11&quot;]</span></span></code></pre></div>
<style type="text/css">
//*[@id="svdMainChartTxt11"]
</style>
<p>위에서 구한 주가의 Xpath를 이용해 해당 데이터를 크롤링하겠습니다.</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="금융-데이터-수집하기-심화.html#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb482-2"><a href="금융-데이터-수집하기-심화.html#cb482-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-3"><a href="금융-데이터-수집하기-심화.html#cb482-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">=</span> <span class="st">&#39;http://comp.fnguide.com/SVO2/ASP/SVD_main.asp?pGB=1&amp;gicode=A005930&#39;</span></span>
<span id="cb482-4"><a href="금융-데이터-수집하기-심화.html#cb482-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">GET</span>(url,</span>
<span id="cb482-5"><a href="금융-데이터-수집하기-심화.html#cb482-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">user_agent</span>(<span class="st">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)</span></span>
<span id="cb482-6"><a href="금융-데이터-수집하기-심화.html#cb482-6" aria-hidden="true" tabindex="-1"></a><span class="st">                      AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36&#39;</span>))</span>
<span id="cb482-7"><a href="금융-데이터-수집하기-심화.html#cb482-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-8"><a href="금융-데이터-수집하기-심화.html#cb482-8" aria-hidden="true" tabindex="-1"></a>price <span class="ot">=</span> <span class="fu">read_html</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb482-9"><a href="금융-데이터-수집하기-심화.html#cb482-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_node</span>(<span class="at">xpath =</span> <span class="st">&#39;//*[@id=&quot;svdMainChartTxt11&quot;]&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb482-10"><a href="금융-데이터-수집하기-심화.html#cb482-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() <span class="sc">%&gt;%</span></span>
<span id="cb482-11"><a href="금융-데이터-수집하기-심화.html#cb482-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parse_number</span>()</span>
<span id="cb482-12"><a href="금융-데이터-수집하기-심화.html#cb482-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-13"><a href="금융-데이터-수집하기-심화.html#cb482-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(price)</span></code></pre></div>
<pre><code>## [1] 70600</code></pre>
<ol style="list-style-type: decimal">
<li>url을 입력한 후, <code>GET()</code> 함수를 이용해 데이터를 불러오며, 역시나 user_agent를 추가해 줍니다.</li>
<li><code>read_html()</code> 함수를 이용해 HTML 데이터를 불러온 후 <code>html_node()</code> 함수에 앞서 구한 Xpath를 입력해 해당 지점의 데이터를 추출합니다.</li>
<li><code>html_text()</code> 함수를 통해 텍스트 데이터만을 추출하며, readr 패키지의 <code>parse_number()</code> 함수를 적용합니다.</li>
</ol>
<p>가치지표를 계산하려면 발행주식수 역시 필요합니다. 예를 들어 PER를 계산하는 방법은 다음과 같습니다.</p>
<p><span class="math display">\[ PER = Price / EPS  = 주가 / 주당순이익\]</span></p>
<p>주당순이익은 순이익을 전체 주식수로 나눈 값이므로, 해당 값의 계산하려면 전체 주식수를 구해야 합니다. 전체 주식수 데이터 역시 웹페이지에 있으므로 앞서 주가를 크롤링한 방법과 동일한 방법으로 구할 수 있습니다. 전체 주식수 데이터의 Xpath는 다음과 같습니다.</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb484-1"><a href="금융-데이터-수집하기-심화.html#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="er">//*[@id=&quot;svdMainGrid1&quot;]/table/tbody/tr[7]/td[1]</span></span></code></pre></div>
<style type="text/css">
//*[@id="svdMainGrid1"]/table/tbody/tr[7]/td[1]
</style>
<p>이를 이용해 발행주식수 중 보통주를 선택하는 방법은 다음과 같습니다.</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="금융-데이터-수집하기-심화.html#cb485-1" aria-hidden="true" tabindex="-1"></a>share <span class="ot">=</span> <span class="fu">read_html</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb485-2"><a href="금융-데이터-수집하기-심화.html#cb485-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_node</span>(</span>
<span id="cb485-3"><a href="금융-데이터-수집하기-심화.html#cb485-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">xpath =</span></span>
<span id="cb485-4"><a href="금융-데이터-수집하기-심화.html#cb485-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;//*[@id=&quot;svdMainGrid1&quot;]/table/tbody/tr[7]/td[1]&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb485-5"><a href="금융-데이터-수집하기-심화.html#cb485-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb485-6"><a href="금융-데이터-수집하기-심화.html#cb485-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-7"><a href="금융-데이터-수집하기-심화.html#cb485-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(share)</span></code></pre></div>
<pre><code>## [1] &quot;5,969,782,550/ 822,886,700&quot;</code></pre>
<p><code>read_html()</code> 함수와 <code>html_node()</code> 함수를 이용해, HTML 내에서 Xpath에 해당하는 데이터를 추출합니다. 그 후 <code>html_text()</code> 함수를 통해 텍스트 부분만 추출합니다. 해당 과정을 거치면 보통주/우선주의 형태로 발행주식주가 저장됩니다. 이 중 우리가 원하는 데이터는 / 앞에 있는 보통주 발행주식수입니다.</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="금융-데이터-수집하기-심화.html#cb487-1" aria-hidden="true" tabindex="-1"></a>share <span class="ot">=</span> share <span class="sc">%&gt;%</span></span>
<span id="cb487-2"><a href="금융-데이터-수집하기-심화.html#cb487-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="st">&#39;/&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb487-3"><a href="금융-데이터-수집하기-심화.html#cb487-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">%&gt;%</span></span>
<span id="cb487-4"><a href="금융-데이터-수집하기-심화.html#cb487-4" aria-hidden="true" tabindex="-1"></a>  .[<span class="dv">1</span>] <span class="sc">%&gt;%</span></span>
<span id="cb487-5"><a href="금융-데이터-수집하기-심화.html#cb487-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parse_number</span>()</span>
<span id="cb487-6"><a href="금융-데이터-수집하기-심화.html#cb487-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-7"><a href="금융-데이터-수집하기-심화.html#cb487-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(share)</span></code></pre></div>
<pre><code>## [1] 5969782550</code></pre>
<ol style="list-style-type: decimal">
<li><code>strsplit()</code> 함수를 통해 /를 기준으로 데이터를 나눕니다. 해당 결과는 리스트 형태로 저장됩니다.</li>
<li><code>unlist()</code> 함수를 통해 리스트를 벡터 형태로 변환합니다.</li>
<li><code>.[1]</code>.[1]을 통해 보통주 발행주식수인 첫 번째 데이터를 선택합니다.</li>
<li><code>parse_number()</code> 함수를 통해 문자형 데이터를 숫자형으로 변환합니다.</li>
</ol>
<p>재무 데이터, 현재 주가, 발행주식수를 이용해 가치지표를 계산해보겠습니다.</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="금융-데이터-수집하기-심화.html#cb489-1" aria-hidden="true" tabindex="-1"></a>data_value <span class="ot">=</span> price <span class="sc">/</span> (value_index <span class="sc">*</span> <span class="dv">100000000</span> <span class="sc">/</span> share)</span>
<span id="cb489-2"><a href="금융-데이터-수집하기-심화.html#cb489-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_value) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;PER&#39;</span>, <span class="st">&#39;PBR&#39;</span>, <span class="st">&#39;PCR&#39;</span>, <span class="st">&#39;PSR&#39;</span>)</span>
<span id="cb489-3"><a href="금융-데이터-수집하기-심화.html#cb489-3" aria-hidden="true" tabindex="-1"></a>data_value[data_value <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb489-4"><a href="금융-데이터-수집하기-심화.html#cb489-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-5"><a href="금융-데이터-수집하기-심화.html#cb489-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data_value)</span></code></pre></div>
<pre><code>##    PER    PBR    PCR    PSR 
## 16.154  1.527  6.456  1.780</code></pre>
<p>분자에는 현재 주가를 입력하며, 분모에는 재무 데이터를 보통주 발행주식수로 나눈 값을 입력합니다. 단, 주가는 원 단위, 재무 데이터는 억 원 단위이므로, 둘 사이에 단위를 동일하게 맞춰주기 위해 분모에 억을 곱합니다. 또한 가치지표가 음수인 경우는 NA로 변경해줍니다.</p>
<p>결과를 확인해보면 4가지 가치지표가 잘 계산되었습니다.<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a></p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="금융-데이터-수집하기-심화.html#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(data_value, <span class="st">&#39;data/KOR_value/005930_value.csv&#39;</span>)</span></code></pre></div>
<p>data 폴더의 KOR_value 폴더 내에 티커_value.csv 이름으로 저장합니다.</p>
</div>
<div id="전-종목-재무제표-및-가치지표-다운로드" class="section level3" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> 전 종목 재무제표 및 가치지표 다운로드</h3>
<p>위 코드에서 for loop 구문을 이용해 URL 중 6자리 티커에 해당하는 값만 변경해주면 모든 종목의 재무제표를 다운로드하고 이를 바탕으로 가치지표를 계산할 수 있습니다. 해당 코드는 다음과 같습니다.</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="금융-데이터-수집하기-심화.html#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb492-2"><a href="금융-데이터-수집하기-심화.html#cb492-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb492-3"><a href="금융-데이터-수집하기-심화.html#cb492-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb492-4"><a href="금융-데이터-수집하기-심화.html#cb492-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb492-5"><a href="금융-데이터-수집하기-심화.html#cb492-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-6"><a href="금융-데이터-수집하기-심화.html#cb492-6" aria-hidden="true" tabindex="-1"></a>KOR_ticker <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&#39;data/KOR_ticker.csv&#39;</span>, <span class="at">row.names =</span> <span class="dv">1</span>)</span>
<span id="cb492-7"><a href="금융-데이터-수집하기-심화.html#cb492-7" aria-hidden="true" tabindex="-1"></a>KOR_ticker<span class="sc">$</span><span class="st">&#39;종목코드&#39;</span> <span class="ot">=</span></span>
<span id="cb492-8"><a href="금융-데이터-수집하기-심화.html#cb492-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_pad</span>(KOR_ticker<span class="sc">$</span><span class="st">&#39;종목코드&#39;</span>, <span class="dv">6</span>,<span class="at">side =</span> <span class="fu">c</span>(<span class="st">&#39;left&#39;</span>), <span class="at">pad =</span> <span class="st">&#39;0&#39;</span>)</span>
<span id="cb492-9"><a href="금융-데이터-수집하기-심화.html#cb492-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-10"><a href="금융-데이터-수집하기-심화.html#cb492-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">dir.exists</span>(<span class="st">&#39;data/KOR_fs&#39;</span>), <span class="cn">FALSE</span>,</span>
<span id="cb492-11"><a href="금융-데이터-수집하기-심화.html#cb492-11" aria-hidden="true" tabindex="-1"></a>       <span class="fu">dir.create</span>(<span class="st">&#39;data/KOR_fs&#39;</span>))</span>
<span id="cb492-12"><a href="금융-데이터-수집하기-심화.html#cb492-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">dir.exists</span>(<span class="st">&#39;data/KOR_value&#39;</span>), <span class="cn">FALSE</span>,</span>
<span id="cb492-13"><a href="금융-데이터-수집하기-심화.html#cb492-13" aria-hidden="true" tabindex="-1"></a>       <span class="fu">dir.create</span>(<span class="st">&#39;data/KOR_value&#39;</span>))</span>
<span id="cb492-14"><a href="금융-데이터-수집하기-심화.html#cb492-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-15"><a href="금융-데이터-수집하기-심화.html#cb492-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> <span class="fu">nrow</span>(KOR_ticker) ) {</span>
<span id="cb492-16"><a href="금융-데이터-수집하기-심화.html#cb492-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb492-17"><a href="금융-데이터-수집하기-심화.html#cb492-17" aria-hidden="true" tabindex="-1"></a>  data_fs <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb492-18"><a href="금융-데이터-수집하기-심화.html#cb492-18" aria-hidden="true" tabindex="-1"></a>  data_value <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb492-19"><a href="금융-데이터-수집하기-심화.html#cb492-19" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">=</span> KOR_ticker<span class="sc">$</span><span class="st">&#39;종목코드&#39;</span>[i]</span>
<span id="cb492-20"><a href="금융-데이터-수집하기-심화.html#cb492-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb492-21"><a href="금융-데이터-수집하기-심화.html#cb492-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 오류 발생 시 이를 무시하고 다음 루프로 진행</span></span>
<span id="cb492-22"><a href="금융-데이터-수집하기-심화.html#cb492-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb492-23"><a href="금융-데이터-수집하기-심화.html#cb492-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-24"><a href="금융-데이터-수집하기-심화.html#cb492-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.setlocale</span>(<span class="st">&#39;LC_ALL&#39;</span>, <span class="st">&#39;English&#39;</span>)</span>
<span id="cb492-25"><a href="금융-데이터-수집하기-심화.html#cb492-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-26"><a href="금융-데이터-수집하기-심화.html#cb492-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># url 생성</span></span>
<span id="cb492-27"><a href="금융-데이터-수집하기-심화.html#cb492-27" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb492-28"><a href="금융-데이터-수집하기-심화.html#cb492-28" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;http://comp.fnguide.com/SVO2/ASP/&#39;</span></span>
<span id="cb492-29"><a href="금융-데이터-수집하기-심화.html#cb492-29" aria-hidden="true" tabindex="-1"></a>      ,<span class="st">&#39;SVD_Finance.asp?pGB=1&amp;gicode=A&#39;</span>,</span>
<span id="cb492-30"><a href="금융-데이터-수집하기-심화.html#cb492-30" aria-hidden="true" tabindex="-1"></a>      name)</span>
<span id="cb492-31"><a href="금융-데이터-수집하기-심화.html#cb492-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-32"><a href="금융-데이터-수집하기-심화.html#cb492-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 이 후 과정은 위와 동일함</span></span>
<span id="cb492-33"><a href="금융-데이터-수집하기-심화.html#cb492-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-34"><a href="금융-데이터-수집하기-심화.html#cb492-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 데이터 다운로드 후 테이블 추출</span></span>
<span id="cb492-35"><a href="금융-데이터-수집하기-심화.html#cb492-35" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">=</span> <span class="fu">GET</span>(url,</span>
<span id="cb492-36"><a href="금융-데이터-수집하기-심화.html#cb492-36" aria-hidden="true" tabindex="-1"></a>               <span class="fu">user_agent</span>(<span class="st">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)</span></span>
<span id="cb492-37"><a href="금융-데이터-수집하기-심화.html#cb492-37" aria-hidden="true" tabindex="-1"></a><span class="st">                          AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb492-38"><a href="금융-데이터-수집하기-심화.html#cb492-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_html</span>() <span class="sc">%&gt;%</span></span>
<span id="cb492-39"><a href="금융-데이터-수집하기-심화.html#cb492-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_table</span>()</span>
<span id="cb492-40"><a href="금융-데이터-수집하기-심화.html#cb492-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-41"><a href="금융-데이터-수집하기-심화.html#cb492-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.setlocale</span>(<span class="st">&#39;LC_ALL&#39;</span>, <span class="st">&#39;Korean&#39;</span>)</span>
<span id="cb492-42"><a href="금융-데이터-수집하기-심화.html#cb492-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-43"><a href="금융-데이터-수집하기-심화.html#cb492-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3개 재무제표를 하나로 합치기</span></span>
<span id="cb492-44"><a href="금융-데이터-수집하기-심화.html#cb492-44" aria-hidden="true" tabindex="-1"></a>    data_IS <span class="ot">=</span> data[[<span class="dv">1</span>]]</span>
<span id="cb492-45"><a href="금융-데이터-수집하기-심화.html#cb492-45" aria-hidden="true" tabindex="-1"></a>    data_BS <span class="ot">=</span> data[[<span class="dv">3</span>]]</span>
<span id="cb492-46"><a href="금융-데이터-수집하기-심화.html#cb492-46" aria-hidden="true" tabindex="-1"></a>    data_CF <span class="ot">=</span> data[[<span class="dv">5</span>]]</span>
<span id="cb492-47"><a href="금융-데이터-수집하기-심화.html#cb492-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-48"><a href="금융-데이터-수집하기-심화.html#cb492-48" aria-hidden="true" tabindex="-1"></a>    data_IS <span class="ot">=</span> data_IS[, <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(data_IS)<span class="sc">-</span><span class="dv">2</span>)]</span>
<span id="cb492-49"><a href="금융-데이터-수집하기-심화.html#cb492-49" aria-hidden="true" tabindex="-1"></a>    data_fs <span class="ot">=</span> <span class="fu">rbind</span>(data_IS, data_BS, data_CF) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb492-50"><a href="금융-데이터-수집하기-심화.html#cb492-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-51"><a href="금융-데이터-수집하기-심화.html#cb492-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 데이터 클랜징</span></span>
<span id="cb492-52"><a href="금융-데이터-수집하기-심화.html#cb492-52" aria-hidden="true" tabindex="-1"></a>    data_fs[, <span class="dv">1</span>] <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">&#39;계산에 참여한 계정 펼치기&#39;</span>,</span>
<span id="cb492-53"><a href="금융-데이터-수집하기-심화.html#cb492-53" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;&#39;</span>, data_fs[, <span class="dv">1</span>])</span>
<span id="cb492-54"><a href="금융-데이터-수집하기-심화.html#cb492-54" aria-hidden="true" tabindex="-1"></a>    data_fs <span class="ot">=</span> data_fs[<span class="sc">!</span><span class="fu">duplicated</span>(data_fs[, <span class="dv">1</span>]), ]</span>
<span id="cb492-55"><a href="금융-데이터-수집하기-심화.html#cb492-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-56"><a href="금융-데이터-수집하기-심화.html#cb492-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(data_fs) <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb492-57"><a href="금융-데이터-수집하기-심화.html#cb492-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(data_fs) <span class="ot">=</span> data_fs[, <span class="dv">1</span>]</span>
<span id="cb492-58"><a href="금융-데이터-수집하기-심화.html#cb492-58" aria-hidden="true" tabindex="-1"></a>    data_fs[, <span class="dv">1</span>] <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb492-59"><a href="금융-데이터-수집하기-심화.html#cb492-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-60"><a href="금융-데이터-수집하기-심화.html#cb492-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 12월 재무제표만 선택</span></span>
<span id="cb492-61"><a href="금융-데이터-수집하기-심화.html#cb492-61" aria-hidden="true" tabindex="-1"></a>    data_fs <span class="ot">=</span></span>
<span id="cb492-62"><a href="금융-데이터-수집하기-심화.html#cb492-62" aria-hidden="true" tabindex="-1"></a>      data_fs[, <span class="fu">substr</span>(<span class="fu">colnames</span>(data_fs), <span class="dv">7</span>, <span class="dv">8</span>) <span class="sc">==</span> <span class="st">&quot;12&quot;</span>]</span>
<span id="cb492-63"><a href="금융-데이터-수집하기-심화.html#cb492-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-64"><a href="금융-데이터-수집하기-심화.html#cb492-64" aria-hidden="true" tabindex="-1"></a>    data_fs <span class="ot">=</span> <span class="fu">sapply</span>(data_fs, <span class="cf">function</span>(x) {</span>
<span id="cb492-65"><a href="금융-데이터-수집하기-심화.html#cb492-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_replace_all</span>(x, <span class="st">&#39;,&#39;</span>, <span class="st">&#39;&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb492-66"><a href="금융-데이터-수집하기-심화.html#cb492-66" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.numeric</span>()</span>
<span id="cb492-67"><a href="금융-데이터-수집하기-심화.html#cb492-67" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span></span>
<span id="cb492-68"><a href="금융-데이터-수집하기-심화.html#cb492-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>(., <span class="at">row.names =</span> <span class="fu">rownames</span>(data_fs))</span>
<span id="cb492-69"><a href="금융-데이터-수집하기-심화.html#cb492-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-70"><a href="금융-데이터-수집하기-심화.html#cb492-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-71"><a href="금융-데이터-수집하기-심화.html#cb492-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 가치지표 분모부분</span></span>
<span id="cb492-72"><a href="금융-데이터-수집하기-심화.html#cb492-72" aria-hidden="true" tabindex="-1"></a>    value_type <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;지배주주순이익&#39;</span>, </span>
<span id="cb492-73"><a href="금융-데이터-수집하기-심화.html#cb492-73" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;자본&#39;</span>, </span>
<span id="cb492-74"><a href="금융-데이터-수집하기-심화.html#cb492-74" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;영업활동으로인한현금흐름&#39;</span>, </span>
<span id="cb492-75"><a href="금융-데이터-수집하기-심화.html#cb492-75" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;매출액&#39;</span>) </span>
<span id="cb492-76"><a href="금융-데이터-수집하기-심화.html#cb492-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-77"><a href="금융-데이터-수집하기-심화.html#cb492-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 해당 재무데이터만 선택</span></span>
<span id="cb492-78"><a href="금융-데이터-수집하기-심화.html#cb492-78" aria-hidden="true" tabindex="-1"></a>    value_index <span class="ot">=</span> data_fs[<span class="fu">match</span>(value_type, <span class="fu">rownames</span>(data_fs)),</span>
<span id="cb492-79"><a href="금융-데이터-수집하기-심화.html#cb492-79" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">ncol</span>(data_fs)]</span>
<span id="cb492-80"><a href="금융-데이터-수집하기-심화.html#cb492-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-81"><a href="금융-데이터-수집하기-심화.html#cb492-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Snapshot 페이지 불러오기</span></span>
<span id="cb492-82"><a href="금융-데이터-수집하기-심화.html#cb492-82" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">=</span></span>
<span id="cb492-83"><a href="금융-데이터-수집하기-심화.html#cb492-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb492-84"><a href="금융-데이터-수집하기-심화.html#cb492-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;http://comp.fnguide.com/SVO2/ASP/SVD_Main.asp&#39;</span>,</span>
<span id="cb492-85"><a href="금융-데이터-수집하기-심화.html#cb492-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;?pGB=1&amp;gicode=A&#39;</span>,name)</span>
<span id="cb492-86"><a href="금융-데이터-수집하기-심화.html#cb492-86" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">=</span> <span class="fu">GET</span>(url,</span>
<span id="cb492-87"><a href="금융-데이터-수집하기-심화.html#cb492-87" aria-hidden="true" tabindex="-1"></a>               <span class="fu">user_agent</span>(<span class="st">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)</span></span>
<span id="cb492-88"><a href="금융-데이터-수집하기-심화.html#cb492-88" aria-hidden="true" tabindex="-1"></a><span class="st">                      AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36&#39;</span>))</span>
<span id="cb492-89"><a href="금융-데이터-수집하기-심화.html#cb492-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-90"><a href="금융-데이터-수집하기-심화.html#cb492-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 현재 주가 크롤링</span></span>
<span id="cb492-91"><a href="금융-데이터-수집하기-심화.html#cb492-91" aria-hidden="true" tabindex="-1"></a>    price <span class="ot">=</span> <span class="fu">read_html</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb492-92"><a href="금융-데이터-수집하기-심화.html#cb492-92" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_node</span>(<span class="at">xpath =</span> <span class="st">&#39;//*[@id=&quot;svdMainChartTxt11&quot;]&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb492-93"><a href="금융-데이터-수집하기-심화.html#cb492-93" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_text</span>() <span class="sc">%&gt;%</span></span>
<span id="cb492-94"><a href="금융-데이터-수집하기-심화.html#cb492-94" aria-hidden="true" tabindex="-1"></a>      <span class="fu">parse_number</span>()</span>
<span id="cb492-95"><a href="금융-데이터-수집하기-심화.html#cb492-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-96"><a href="금융-데이터-수집하기-심화.html#cb492-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 보통주 발행주식수 크롤링</span></span>
<span id="cb492-97"><a href="금융-데이터-수집하기-심화.html#cb492-97" aria-hidden="true" tabindex="-1"></a>    share <span class="ot">=</span> <span class="fu">read_html</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb492-98"><a href="금융-데이터-수집하기-심화.html#cb492-98" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_node</span>(</span>
<span id="cb492-99"><a href="금융-데이터-수집하기-심화.html#cb492-99" aria-hidden="true" tabindex="-1"></a>        <span class="at">xpath =</span></span>
<span id="cb492-100"><a href="금융-데이터-수집하기-심화.html#cb492-100" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;//*[@id=&quot;svdMainGrid1&quot;]/table/tbody/tr[7]/td[1]&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb492-101"><a href="금융-데이터-수집하기-심화.html#cb492-101" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_text</span>() <span class="sc">%&gt;%</span></span>
<span id="cb492-102"><a href="금융-데이터-수집하기-심화.html#cb492-102" aria-hidden="true" tabindex="-1"></a>      <span class="fu">strsplit</span>(<span class="st">&#39;/&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb492-103"><a href="금융-데이터-수집하기-심화.html#cb492-103" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlist</span>() <span class="sc">%&gt;%</span></span>
<span id="cb492-104"><a href="금융-데이터-수집하기-심화.html#cb492-104" aria-hidden="true" tabindex="-1"></a>      .[<span class="dv">1</span>] <span class="sc">%&gt;%</span></span>
<span id="cb492-105"><a href="금융-데이터-수집하기-심화.html#cb492-105" aria-hidden="true" tabindex="-1"></a>      <span class="fu">parse_number</span>()</span>
<span id="cb492-106"><a href="금융-데이터-수집하기-심화.html#cb492-106" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-107"><a href="금융-데이터-수집하기-심화.html#cb492-107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 가치지표 계산</span></span>
<span id="cb492-108"><a href="금융-데이터-수집하기-심화.html#cb492-108" aria-hidden="true" tabindex="-1"></a>    data_value <span class="ot">=</span> price <span class="sc">/</span> (value_index <span class="sc">*</span> <span class="dv">100000000</span><span class="sc">/</span> share)</span>
<span id="cb492-109"><a href="금융-데이터-수집하기-심화.html#cb492-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(data_value) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;PER&#39;</span>, <span class="st">&#39;PBR&#39;</span>, <span class="st">&#39;PCR&#39;</span>, <span class="st">&#39;PSR&#39;</span>)</span>
<span id="cb492-110"><a href="금융-데이터-수집하기-심화.html#cb492-110" aria-hidden="true" tabindex="-1"></a>    data_value[data_value <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb492-111"><a href="금융-데이터-수집하기-심화.html#cb492-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-112"><a href="금융-데이터-수집하기-심화.html#cb492-112" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb492-113"><a href="금융-데이터-수집하기-심화.html#cb492-113" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb492-114"><a href="금융-데이터-수집하기-심화.html#cb492-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 오류 발생시 해당 종목명을 출력하고 다음 루프로 이동</span></span>
<span id="cb492-115"><a href="금융-데이터-수집하기-심화.html#cb492-115" aria-hidden="true" tabindex="-1"></a>    data_fs <span class="ot">&lt;&lt;-</span> <span class="cn">NA</span></span>
<span id="cb492-116"><a href="금융-데이터-수집하기-심화.html#cb492-116" aria-hidden="true" tabindex="-1"></a>    data_value <span class="ot">&lt;&lt;-</span> <span class="cn">NA</span></span>
<span id="cb492-117"><a href="금융-데이터-수집하기-심화.html#cb492-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste0</span>(<span class="st">&quot;Error in Ticker: &quot;</span>, name))</span>
<span id="cb492-118"><a href="금융-데이터-수집하기-심화.html#cb492-118" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb492-119"><a href="금융-데이터-수집하기-심화.html#cb492-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb492-120"><a href="금융-데이터-수집하기-심화.html#cb492-120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 다운로드 받은 파일을 생성한 각각의 폴더 내 csv 파일로 저장</span></span>
<span id="cb492-121"><a href="금융-데이터-수집하기-심화.html#cb492-121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb492-122"><a href="금융-데이터-수집하기-심화.html#cb492-122" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 재무제표 저장</span></span>
<span id="cb492-123"><a href="금융-데이터-수집하기-심화.html#cb492-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(data_fs, <span class="fu">paste0</span>(<span class="st">&#39;data/KOR_fs/&#39;</span>, name, <span class="st">&#39;_fs.csv&#39;</span>))</span>
<span id="cb492-124"><a href="금융-데이터-수집하기-심화.html#cb492-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb492-125"><a href="금융-데이터-수집하기-심화.html#cb492-125" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 가치지표 저장</span></span>
<span id="cb492-126"><a href="금융-데이터-수집하기-심화.html#cb492-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(data_value, <span class="fu">paste0</span>(<span class="st">&#39;data/KOR_value/&#39;</span>, name,</span>
<span id="cb492-127"><a href="금융-데이터-수집하기-심화.html#cb492-127" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&#39;_value.csv&#39;</span>))</span>
<span id="cb492-128"><a href="금융-데이터-수집하기-심화.html#cb492-128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb492-129"><a href="금융-데이터-수집하기-심화.html#cb492-129" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2초간 타임슬립 적용</span></span>
<span id="cb492-130"><a href="금융-데이터-수집하기-심화.html#cb492-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">2</span>)</span>
<span id="cb492-131"><a href="금융-데이터-수집하기-심화.html#cb492-131" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>전 종목 주가 데이터를 받는 과정과 동일하게 KOR_ticker.csv 파일을 불러온 후 for loop를 통해 i 값이 변함에 따라 티커를 변경해가며 모든 종목의 재무제표 및 가치지표를 다운로드합니다. <code>tryCatch()</code> 함수를 이용해 오류가 발생하면 NA로 이루어진 빈 데이터를 저장한 후 다음 루프로 넘어가게 됩니다. data/KOR_fs 폴더에는 전 종목의 재무제표 데이터가 저장되고, data/KOR_value 폴더에는 전 종목의 가치지표 데이터가 csv 형태로 저장됩니다.</p>
</div>
</div>
<div id="dart의-open-api를-이용한-데이터-수집하기" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> DART의 Open API를 이용한 데이터 수집하기</h2>
<p>DART(Data Analysis, Retrieval and Transfer System)는 금융감독원 전자공시시스템으로써, 상장법인 등이 공시서류를 인터넷으로 제출하고, 투자자 등 이용자는 제출 즉시 인터넷을 통해 조회할 수 있도록 하는 종합적 기업공시 시스템입니다. 홈페이지에서도 각종 공시내역을 확인할 수 있지만, 해당 사이트에서 제공하는 API를 이용할 경우 더욱 쉽게 공시 내용을 수집할 수 있습니다.</p>
<div id="api-key발급-및-추가하기" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> API Key발급 및 추가하기</h3>
<p>먼저 <a href="https://opendart.fss.or.kr/에" class="uri">https://opendart.fss.or.kr/에</a> 접속한 후 [인증키 신청/관리] → [인증키 신청]을 통해 API Key를 발급 받습니다.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-311"></span>
<img src="images/dart_api_key.png" alt="OpenAPI 인증키 신청" width="100%" />
<p class="caption">
그림 6.4: OpenAPI 인증키 신청
</p>
</div>
<p>계정을 생성하고 이메일을 통해 이용자 등록을 한 후 로그인을 합니다. 그 후 [오픈API 이용현황]을 살펴보면 <strong>API Key</strong> 부분에 발급받은 Key가 있으며, 금일 몇번의 API를 요청했는지가 일일이용현황에 나옵니다. 하루 총 10,000번까지 데이터를 요청할 수 있습니다.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-312"></span>
<img src="images/dart_api_status.png" alt="OpenAPI 이용현황" width="100%" />
<p class="caption">
그림 6.5: OpenAPI 이용현황
</p>
</div>
<p>다음으로 발급받은 API Key를 <strong>.Renviron</strong> 파일에 추가하도록 합니다. 해당 파일에는 여러 패스워드를 추가해 안전하게 관리할 수 있습니다.</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="금융-데이터-수집하기-심화.html#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.edit</span>(<span class="st">&quot;~/.Renviron&quot;</span>)</span></code></pre></div>
<p><strong>.Renviron</strong> 파일이 열리면 다음과 같이 입력을 해줍니다.</p>
<pre><code>dart_api_key = &#39;발급받은 API&#39;</code></pre>
<p>파일을 저장한 후 해당 파일을 적용하기 위해 <strong>R의 Session을 재시작합니다.</strong> 그 후 아래 명령어를 실행하여 API Key를 불러오도록 합니다. (재시작하지 않으면 Key를 불러올 수 없습니다.)</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="금융-데이터-수집하기-심화.html#cb495-1" aria-hidden="true" tabindex="-1"></a>dart_api <span class="ot">=</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;dart_api_key&quot;</span>)</span></code></pre></div>
</div>
<div id="고유번호-다운로드" class="section level3" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> 고유번호 다운로드</h3>
<p>Open API에서 각 기업의 데이터를 받기 위해서는 종목에 해당하는 고유번호를 알아야 합니다. 이에 대한 개발가이드는 아래 페이지에 나와 있습니다.</p>
<p><a href="https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS001&amp;apiId=2019018" class="uri">https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS001&amp;apiId=2019018</a></p>
<p>위 페이지의 내용을 코드로 나타내보도록 합니다.</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="금융-데이터-수집하기-심화.html#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb496-2"><a href="금융-데이터-수집하기-심화.html#cb496-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb496-3"><a href="금융-데이터-수집하기-심화.html#cb496-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-4"><a href="금융-데이터-수집하기-심화.html#cb496-4" aria-hidden="true" tabindex="-1"></a>codezip_url <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb496-5"><a href="금융-데이터-수집하기-심화.html#cb496-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;https://opendart.fss.or.kr/api/corpCode.xml?crtfc_key=&#39;</span>,dart_api)</span>
<span id="cb496-6"><a href="금융-데이터-수집하기-심화.html#cb496-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-7"><a href="금융-데이터-수집하기-심화.html#cb496-7" aria-hidden="true" tabindex="-1"></a>codezip_data <span class="ot">=</span> <span class="fu">GET</span>(codezip_url)</span>
<span id="cb496-8"><a href="금융-데이터-수집하기-심화.html#cb496-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(codezip_data)</span></code></pre></div>
<pre><code>## Response [https://opendart.fss.or.kr/api/corpCode.xml?crtfc_key=b1a630e527b0e5ff5bd58ed81b49825017fa80b8]
##   Date: 2021-11-05 07:43
##   Status: 200
##   Content-Type: application/x-msdownload
##   Size: 1.5 MB
## &lt;BINARY BODY&gt;</code></pre>
<pre><code>## NULL</code></pre>
<ol style="list-style-type: decimal">
<li><strong><a href="https://opendart.fss.or.kr/api/corpCode.xml?crtfc_key=" class="uri">https://opendart.fss.or.kr/api/corpCode.xml?crtfc_key=</a></strong> 뒤에 본인의 API 키를 입력합니다.</li>
<li><code>GET()</code> 함수를 통해 해당 페이지 내용을 받습니다.</li>
</ol>
<p>다운로드 받은 내용을 확인해보면 <BINARY BODY>, 즉 바이너리 형태의 데이터가 첨부되어 있습니다. 이에 대해 좀더 자세히 알아보도록 하겠습니다.</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="금융-데이터-수집하기-심화.html#cb499-1" aria-hidden="true" tabindex="-1"></a>codezip_data<span class="sc">$</span>headers[[<span class="st">&quot;content-disposition&quot;</span>]]</span></code></pre></div>
<pre><code>## [1] &quot;: attachment; filename=CORPCODE.zip&quot;</code></pre>
<p>headers의 “content-disposition” 부분을 확인해보면 <strong>CORPCODE.zip</strong> 파일이 첨부되어 있습니다. 해당 파일의 압축을 풀어 첨부된 내용을 확인합니다.</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="금융-데이터-수집하기-심화.html#cb501-1" aria-hidden="true" tabindex="-1"></a>tf <span class="ot">=</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&#39;.zip&#39;</span>)</span>
<span id="cb501-2"><a href="금융-데이터-수집하기-심화.html#cb501-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-3"><a href="금융-데이터-수집하기-심화.html#cb501-3" aria-hidden="true" tabindex="-1"></a><span class="fu">writeBin</span>(</span>
<span id="cb501-4"><a href="금융-데이터-수집하기-심화.html#cb501-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">content</span>(codezip_data, <span class="at">as =</span> <span class="st">&quot;raw&quot;</span>),</span>
<span id="cb501-5"><a href="금융-데이터-수집하기-심화.html#cb501-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(tf)</span>
<span id="cb501-6"><a href="금융-데이터-수집하기-심화.html#cb501-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb501-7"><a href="금융-데이터-수집하기-심화.html#cb501-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-8"><a href="금융-데이터-수집하기-심화.html#cb501-8" aria-hidden="true" tabindex="-1"></a>nm <span class="ot">=</span> <span class="fu">unzip</span>(tf, <span class="at">list =</span> <span class="cn">TRUE</span>)</span>
<span id="cb501-9"><a href="금융-데이터-수집하기-심화.html#cb501-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(nm)</span></code></pre></div>
<pre><code>##           Name   Length Date
## 1 CORPCODE.xml 17114213 &lt;NA&gt;</code></pre>
<ol style="list-style-type: decimal">
<li><code>tempfile()</code> 함수 통해 빈 .zip 파일을 만듭니다.</li>
<li><code>writeBin()</code> 함수는 바이너리 형태의 파일을 저장하는 함수이며, <code>content()</code>를 통해 첨부 파일 내용을 raw 형태로 저장합니다. 파일명은 위에서 만든 tf로 합니다.</li>
<li><code>unzip()</code> 함수를 통해 zip 내 파일 리스트를 확인합니다.</li>
</ol>
<p>zip 파일 내에는 CORPCODE.xml 파일이 있으며, xml2 패키지의 <code>read_xml()</code> 함수를 통해 이를 불러오도록 합니다.</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="금융-데이터-수집하기-심화.html#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="cb503-2"><a href="금융-데이터-수집하기-심화.html#cb503-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb503-3"><a href="금융-데이터-수집하기-심화.html#cb503-3" aria-hidden="true" tabindex="-1"></a>code_data <span class="ot">=</span> <span class="fu">read_xml</span>(<span class="fu">unzip</span>(tf, nm<span class="sc">$</span>Name))</span>
<span id="cb503-4"><a href="금융-데이터-수집하기-심화.html#cb503-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(code_data)</span></code></pre></div>
<pre><code>## {xml_document}
## &lt;result&gt;
##  [1] &lt;list&gt;\n  &lt;corp_code&gt;00434003&lt;/corp_code&gt;\n  &lt;corp_name&gt;다코&lt;/corp_name&gt;\n ...
##  [2] &lt;list&gt;\n  &lt;corp_code&gt;00434456&lt;/corp_code&gt;\n  &lt;corp_name&gt;일산약품&lt;/corp_name&gt; ...
##  [3] &lt;list&gt;\n  &lt;corp_code&gt;00430964&lt;/corp_code&gt;\n  &lt;corp_name&gt;굿앤엘에스&lt;/corp_name ...
##  [4] &lt;list&gt;\n  &lt;corp_code&gt;00432403&lt;/corp_code&gt;\n  &lt;corp_name&gt;한라판지&lt;/corp_name&gt; ...
##  [5] &lt;list&gt;\n  &lt;corp_code&gt;00388953&lt;/corp_code&gt;\n  &lt;corp_name&gt;크레디피아제이십오차유동화전문회 ...
##  [6] &lt;list&gt;\n  &lt;corp_code&gt;00179984&lt;/corp_code&gt;\n  &lt;corp_name&gt;연방건설산업&lt;/corp_nam ...
##  [7] &lt;list&gt;\n  &lt;corp_code&gt;00420143&lt;/corp_code&gt;\n  &lt;corp_name&gt;브룩스피알아이오토메이션잉크&lt;/ ...
##  [8] &lt;list&gt;\n  &lt;corp_code&gt;00401111&lt;/corp_code&gt;\n  &lt;corp_name&gt;매경아이비아이&lt;/corp_na ...
##  [9] &lt;list&gt;\n  &lt;corp_code&gt;00435534&lt;/corp_code&gt;\n  &lt;corp_name&gt;캐드뱅크&lt;/corp_name&gt; ...
## [10] &lt;list&gt;\n  &lt;corp_code&gt;00430186&lt;/corp_code&gt;\n  &lt;corp_name&gt;엠와이오피삼차유동화전문유한회사 ...
## [11] &lt;list&gt;\n  &lt;corp_code&gt;00430201&lt;/corp_code&gt;\n  &lt;corp_name&gt;엠와이오피이차유동화전문유한회사 ...
## [12] &lt;list&gt;\n  &lt;corp_code&gt;00430210&lt;/corp_code&gt;\n  &lt;corp_name&gt;엠와이오피일차유동화전문유한회사 ...
## [13] &lt;list&gt;\n  &lt;corp_code&gt;00430229&lt;/corp_code&gt;\n  &lt;corp_name&gt;포스미디어&lt;/corp_name ...
## [14] &lt;list&gt;\n  &lt;corp_code&gt;00140432&lt;/corp_code&gt;\n  &lt;corp_name&gt;축복할렐루야&lt;/corp_nam ...
## [15] &lt;list&gt;\n  &lt;corp_code&gt;00426208&lt;/corp_code&gt;\n  &lt;corp_name&gt;한국전자화학&lt;/corp_nam ...
## [16] &lt;list&gt;\n  &lt;corp_code&gt;00433262&lt;/corp_code&gt;\n  &lt;corp_name&gt;ConnachtCapitalM ...
## [17] &lt;list&gt;\n  &lt;corp_code&gt;00433749&lt;/corp_code&gt;\n  &lt;corp_name&gt;선진아이티&lt;/corp_name ...
## [18] &lt;list&gt;\n  &lt;corp_code&gt;00433785&lt;/corp_code&gt;\n  &lt;corp_name&gt;팀스코리아&lt;/corp_name ...
## [19] &lt;list&gt;\n  &lt;corp_code&gt;00196079&lt;/corp_code&gt;\n  &lt;corp_name&gt;에넥스하이테크&lt;/corp_na ...
## [20] &lt;list&gt;\n  &lt;corp_code&gt;00435048&lt;/corp_code&gt;\n  &lt;corp_name&gt;세이스텝바이스텝혼합형펀드&lt;/c ...
## ...</code></pre>
<p>해당 파일은 HTML 형식으로 되어 있으며 중요부분은 다음과 같습니다.</p>
<ul>
<li>corp_code: 고유번호</li>
<li>corp_name: 종목명</li>
<li>corp_stock: 거래소 상장 티커</li>
</ul>
<p>HTML의 태그를 이용해 각 부분을 추출한 후 하나의 데이터로 합치도록 하겠습니다.</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="금융-데이터-수집하기-심화.html#cb505-1" aria-hidden="true" tabindex="-1"></a>corp_code <span class="ot">=</span> code_data <span class="sc">%&gt;%</span> <span class="fu">html_nodes</span>(<span class="st">&#39;corp_code&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">html_text</span>()</span>
<span id="cb505-2"><a href="금융-데이터-수집하기-심화.html#cb505-2" aria-hidden="true" tabindex="-1"></a>corp_name <span class="ot">=</span> code_data <span class="sc">%&gt;%</span> <span class="fu">html_nodes</span>(<span class="st">&#39;corp_name&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">html_text</span>()</span>
<span id="cb505-3"><a href="금융-데이터-수집하기-심화.html#cb505-3" aria-hidden="true" tabindex="-1"></a>corp_stock <span class="ot">=</span> code_data <span class="sc">%&gt;%</span> <span class="fu">html_nodes</span>(<span class="st">&#39;stock_code&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">html_text</span>()</span>
<span id="cb505-4"><a href="금융-데이터-수집하기-심화.html#cb505-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-5"><a href="금융-데이터-수집하기-심화.html#cb505-5" aria-hidden="true" tabindex="-1"></a>corp_list <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb505-6"><a href="금융-데이터-수집하기-심화.html#cb505-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;code&#39;</span> <span class="ot">=</span> corp_code,</span>
<span id="cb505-7"><a href="금융-데이터-수집하기-심화.html#cb505-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;name&#39;</span> <span class="ot">=</span> corp_name,</span>
<span id="cb505-8"><a href="금융-데이터-수집하기-심화.html#cb505-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;stock&#39;</span> <span class="ot">=</span> corp_stock,</span>
<span id="cb505-9"><a href="금융-데이터-수집하기-심화.html#cb505-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb505-10"><a href="금융-데이터-수집하기-심화.html#cb505-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><code>html_nodes()</code> 함수를 이용해 고유번호, 종목명, 상장티커를 선택한 후, <code>html_text()</code> 함수를 이용해 문자열만 추출하도록 합니다.</li>
<li><code>data.frame()</code> 함수를 통해 데이터프레임 형식으로 묶어주도록 합니다.</li>
</ol>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="금융-데이터-수집하기-심화.html#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(corp_list)</span></code></pre></div>
<pre><code>## [1] 88754</code></pre>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="금융-데이터-수집하기-심화.html#cb508-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(corp_list)</span></code></pre></div>
<pre><code>##       code                               name stock
## 1 00434003                               다코      
## 2 00434456                           일산약품      
## 3 00430964                         굿앤엘에스      
## 4 00432403                           한라판지      
## 5 00388953 크레디피아제이십오차유동화전문회사      
## 6 00179984                       연방건설산업</code></pre>
<p>종목수를 확인해보면 88754 개가 확인되며, 이 중 stock 열이 빈 종목은 거래소에 상장되지 않은 종목입니다. 따라서 해당 데이터는 삭제하여 거래소 상장 종목만을 남긴 후, csv 파일로 저장하도록 합니다.</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="금융-데이터-수집하기-심화.html#cb510-1" aria-hidden="true" tabindex="-1"></a>corp_list <span class="ot">=</span> corp_list[corp_list<span class="sc">$</span>stock <span class="sc">!=</span> <span class="st">&quot; &quot;</span>, ]</span>
<span id="cb510-2"><a href="금융-데이터-수집하기-심화.html#cb510-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb510-3"><a href="금융-데이터-수집하기-심화.html#cb510-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(corp_list, <span class="st">&#39;data/corp_list.csv&#39;</span>)</span></code></pre></div>
</div>
<div id="공시검색" class="section level3" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> 공시검색</h3>
<div id="전체-공시-검색" class="section level4" number="6.3.3.1">
<h4><span class="header-section-number">6.3.3.1</span> 전체 공시 검색</h4>
<p>먼저 공시검색 API에 대한 이해를 위해 전체 종목의 공시를 수집하도록 하며, 해당 개발가이드는 아래 페이지에 나와 있습니다.</p>
<p><a href="https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS001&amp;apiId=2019001" class="uri">https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS001&amp;apiId=2019001</a></p>
<p>각종 요청인자를 통해 url을 생성 후 전송하여, 요청에 맞는 데이터를 받을 수 있습니다. 공시 검색에 해당하는 인자는 다음과 같습니다.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-322"></span>
<img src="images/dart_api_input.png" alt="OpenAPI 요청 인자 예시" width="100%" />
<p class="caption">
그림 6.6: OpenAPI 요청 인자 예시
</p>
</div>
<p>페이지 하단에서 인자를 입력 후 [검색]을 누르면 각 인자에 맞게 생성된 url과 그 결과를 볼 수 있습니다.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-323"></span>
<img src="images/dart_api_exam.png" alt="OpenAPI 테스트 예시" width="100%" />
<p class="caption">
그림 6.7: OpenAPI 테스트 예시
</p>
</div>
<p>먼저 시작일과 종료일을 토대로 최근 공시 100건에 해당하는 url을 생성하도록 하겠습니다.</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="금융-데이터-수집하기-심화.html#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb511-2"><a href="금융-데이터-수집하기-심화.html#cb511-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb511-3"><a href="금융-데이터-수집하기-심화.html#cb511-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb511-4"><a href="금융-데이터-수집하기-심화.html#cb511-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb511-5"><a href="금융-데이터-수집하기-심화.html#cb511-5" aria-hidden="true" tabindex="-1"></a>bgn_date <span class="ot">=</span> (<span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="fu">days</span>(<span class="dv">7</span>)) <span class="sc">%&gt;%</span> <span class="fu">str_remove_all</span>(<span class="st">&#39;-&#39;</span>)</span>
<span id="cb511-6"><a href="금융-데이터-수집하기-심화.html#cb511-6" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">=</span> (<span class="fu">Sys.Date</span>() ) <span class="sc">%&gt;%</span> <span class="fu">str_remove_all</span>(<span class="st">&#39;-&#39;</span>)</span>
<span id="cb511-7"><a href="금융-데이터-수집하기-심화.html#cb511-7" aria-hidden="true" tabindex="-1"></a>notice_url <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&#39;https://opendart.fss.or.kr/api/list.json?crtfc_key=&#39;</span>,dart_api,<span class="st">&#39;&amp;bgn_de=&#39;</span>,</span>
<span id="cb511-8"><a href="금융-데이터-수집하기-심화.html#cb511-8" aria-hidden="true" tabindex="-1"></a>                    bgn_date,<span class="st">&#39;&amp;end_de=&#39;</span>,end_date,<span class="st">&#39;&amp;page_no=1&amp;page_count=100&#39;</span>)</span></code></pre></div>
<p>bgn_date에는 현재로부터 일주일 전을, end_date는 오늘 날짜를, 페이지별 건수에 해당하는 page_count에는 100을 입력하도록 합니다. 그 후 홈페이지에 나와있는 예시에 맞게 url을 작성해주도록 합니다. XML 보다는 JSON 형식으로 url을 생성 후 요청하는 것이 데이터 처리 측면에서 훨씬 효율적입니다.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="금융-데이터-수집하기-심화.html#cb512-1" aria-hidden="true" tabindex="-1"></a>notice_data <span class="ot">=</span> <span class="fu">fromJSON</span>(notice_url) </span>
<span id="cb512-2"><a href="금융-데이터-수집하기-심화.html#cb512-2" aria-hidden="true" tabindex="-1"></a>notice_data <span class="ot">=</span> notice_data[[<span class="st">&#39;list&#39;</span>]]</span>
<span id="cb512-3"><a href="금융-데이터-수집하기-심화.html#cb512-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-4"><a href="금융-데이터-수집하기-심화.html#cb512-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(notice_data)</span></code></pre></div>
<pre><code>##   corp_code    corp_name stock_code corp_cls
## 1  00111722 미래에셋증권     006800        Y
## 2  00356361       LG화학     051910        Y
## 3  00232821 클라우드에어     036170        K
## 4  00363510       얍엑스     060230        K
## 5  00186452   릭스솔루션     029480        K
## 6  00107613 이수페타시스     007660        Y
##                                report_nm       rcept_no       flr_nm rcept_dt
## 1                     증권발행실적보고서 20211105000388 미래에셋증권 20211105
## 2           기업설명회(IR)개최(안내공시) 20211105800629       LG화학 20211105
## 3 임원ㆍ주요주주특정증권등소유상황보고서 20211105000385     케이앤커 20211105
## 4             [기재정정]주주총회소집결의 20211105900534       얍엑스 20211105
## 5       주식등의대량보유상황보고서(약식) 20211105000383   에스엘파워 20211105
## 6                     증권발행실적보고서 20211105000382 이수페타시스 20211105
##   rm
## 1   
## 2 유
## 3   
## 4 코
## 5   
## 6</code></pre>
<p><code>fromJSON()</code> 함수를 통해 JSON 데이터를 받은 후 list를 확인해보면 우리가 원하는 공시정보, 즉 일주일 전부터 100건의 공시 정보가 다운로드 되어 있습니다.</p>
</div>
<div id="특정-기업의-공시-검색" class="section level4" number="6.3.3.2">
<h4><span class="header-section-number">6.3.3.2</span> 특정 기업의 공시 검색</h4>
<p>이번에는 고유번호를 추가하여 원하는 기업의 공시만 확인해보록 하겠습니다. 고유번호는 위에서 다운받은 <strong>corp_list.csv</strong> 파일을 통해 확인해볼 수 있으며, 예시로 살펴볼 삼성전자의 고유번호는 00126380 입니다.</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="금융-데이터-수집하기-심화.html#cb514-1" aria-hidden="true" tabindex="-1"></a>bgn_date <span class="ot">=</span> (<span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="fu">days</span>(<span class="dv">30</span>)) <span class="sc">%&gt;%</span> <span class="fu">str_remove_all</span>(<span class="st">&#39;-&#39;</span>)</span>
<span id="cb514-2"><a href="금융-데이터-수집하기-심화.html#cb514-2" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">=</span> (<span class="fu">Sys.Date</span>() ) <span class="sc">%&gt;%</span> <span class="fu">str_remove_all</span>(<span class="st">&#39;-&#39;</span>)</span>
<span id="cb514-3"><a href="금융-데이터-수집하기-심화.html#cb514-3" aria-hidden="true" tabindex="-1"></a>corp_code <span class="ot">=</span> <span class="st">&#39;00126380&#39;</span></span>
<span id="cb514-4"><a href="금융-데이터-수집하기-심화.html#cb514-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb514-5"><a href="금융-데이터-수집하기-심화.html#cb514-5" aria-hidden="true" tabindex="-1"></a>notice_url_ss <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb514-6"><a href="금융-데이터-수집하기-심화.html#cb514-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;https://opendart.fss.or.kr/api/list.json?crtfc_key=&#39;</span>,dart_api,</span>
<span id="cb514-7"><a href="금융-데이터-수집하기-심화.html#cb514-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;&amp;corp_code=&#39;</span>, corp_code, </span>
<span id="cb514-8"><a href="금융-데이터-수집하기-심화.html#cb514-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;&amp;bgn_de=&#39;</span>, bgn_date,<span class="st">&#39;&amp;end_de=&#39;</span>,</span>
<span id="cb514-9"><a href="금융-데이터-수집하기-심화.html#cb514-9" aria-hidden="true" tabindex="-1"></a>  end_date,<span class="st">&#39;&amp;page_no=1&amp;page_count=100&#39;</span>)</span></code></pre></div>
<p>시작일을 과거 30일로 수정하였으며, 기존 url에 <strong>&amp;corp_code=</strong> 부분을 추가하였습니다.</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="금융-데이터-수집하기-심화.html#cb515-1" aria-hidden="true" tabindex="-1"></a>notice_data_ss <span class="ot">=</span> <span class="fu">fromJSON</span>(notice_url_ss) </span>
<span id="cb515-2"><a href="금융-데이터-수집하기-심화.html#cb515-2" aria-hidden="true" tabindex="-1"></a>notice_data_ss <span class="ot">=</span> notice_data_ss[[<span class="st">&#39;list&#39;</span>]]</span>
<span id="cb515-3"><a href="금융-데이터-수집하기-심화.html#cb515-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-4"><a href="금융-데이터-수집하기-심화.html#cb515-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(notice_data_ss)</span></code></pre></div>
<pre><code>##   corp_code corp_name stock_code corp_cls
## 1  00126380  삼성전자     005930        Y
## 2  00126380  삼성전자     005930        Y
## 3  00126380  삼성전자     005930        Y
## 4  00126380  삼성전자     005930        Y
## 5  00126380  삼성전자     005930        Y
## 6  00126380  삼성전자     005930        Y
##                                report_nm       rcept_no       flr_nm rcept_dt
## 1       주식등의대량보유상황보고서(약식) 20211103000100 국민연금공단 20211103
## 2       주식등의대량보유상황보고서(일반) 20211029000589     삼성물산 20211029
## 3 임원ㆍ주요주주특정증권등소유상황보고서 20211029000179       안규리 20211029
## 4                 기타경영사항(자율공시) 20211028800081     삼성전자 20211028
## 5                   특수관계인에대한출자 20211028000016     삼성전자 20211028
## 6                   특수관계인에대한출자 20211028000015     삼성전자 20211028
##   rm
## 1   
## 2   
## 3   
## 4 유
## 5 공
## 6 공</code></pre>
<p>역시나 JSON 형태로 손쉽게 공시정보를 다운로드 받을 수 있습니다. 이 중 rcept_no는 공시번호에 해당하며, 해당 데이터를 이용해 공시에 해당하는 url에 접속을 할 수도 있습니다.</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="금융-데이터-수집하기-심화.html#cb517-1" aria-hidden="true" tabindex="-1"></a>notice_url_exam <span class="ot">=</span> notice_data_ss[<span class="dv">1</span>, <span class="st">&#39;rcept_no&#39;</span>]</span>
<span id="cb517-2"><a href="금융-데이터-수집하기-심화.html#cb517-2" aria-hidden="true" tabindex="-1"></a>notice_dart_url <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb517-3"><a href="금융-데이터-수집하기-심화.html#cb517-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;http://dart.fss.or.kr/dsaf001/main.do?rcpNo=&#39;</span>,notice_url_exam)</span>
<span id="cb517-4"><a href="금융-데이터-수집하기-심화.html#cb517-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb517-5"><a href="금융-데이터-수집하기-심화.html#cb517-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(notice_dart_url)</span></code></pre></div>
<pre><code>## [1] &quot;http://dart.fss.or.kr/dsaf001/main.do?rcpNo=20211103000100&quot;</code></pre>
<p>dart 홈페이지의 공시에 해당하는 url과 첫번째 공시에 해당하는 공시번호를 합쳐주도록 합니다.</p>
<p>위 url에 접속하여 해당 공시를 좀 더 자세하게 확인할 수 있습니다.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-330"></span>
<img src="images/dart_api_web.png" alt="공시 정보의 확인" width="100%" />
<p class="caption">
그림 6.8: 공시 정보의 확인
</p>
</div>
</div>
</div>
<div id="사업보고서-주요-정보" class="section level3" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> 사업보고서 주요 정보</h3>
<p>API를 이용하여 사업보고서의 주요 정보 역시 다운로드 받을 수 있으며, 제공하는 목록은 다음과 같습니다.</p>
<p><a href="https://opendart.fss.or.kr/guide/main.do?apiGrpCd=DS002" class="uri">https://opendart.fss.or.kr/guide/main.do?apiGrpCd=DS002</a></p>
<p>이 중 예시로써 [배당에 관한 사항]을 다운로드 받도록 하며, 개발가이드 페이지는 다음과 같습니다.</p>
<p><a href="https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS002&amp;apiId=2019005" class="uri">https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS002&amp;apiId=2019005</a></p>
<p>url 생성에 필요한 요청 인자는 다음과 같습니다.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-331">표 6.3: </span>배당에 관한 사항 주요 인자
</caption>
<thead>
<tr>
<th style="text-align:left;">
키
</th>
<th style="text-align:left;">
명칭
</th>
<th style="text-align:left;">
설명
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
crtfc_key
</td>
<td style="text-align:left;">
API 인증키
</td>
<td style="text-align:left;">
발급받은 인증키
</td>
</tr>
<tr>
<td style="text-align:left;">
corp_code
</td>
<td style="text-align:left;">
고유번호
</td>
<td style="text-align:left;">
공시대상회사의 고유번호(8자리)
</td>
</tr>
<tr>
<td style="text-align:left;">
bsns_year
</td>
<td style="text-align:left;">
사업년도
</td>
<td style="text-align:left;">
사업연도(4자리)
</td>
</tr>
<tr>
<td style="text-align:left;">
reprt_code
</td>
<td style="text-align:left;">
보고서 코드
</td>
<td style="text-align:left;">
<li>
1분기보고서 : 11013
</li>
<li>
반기보고서 : 11012
</li>
<li>
3분기보고서 : 11014
</li>
<li>
사업보고서 : 11011
</li>
</td>
</tr>
</tbody>
</table>
<p>이를 바탕으로 삼성전자의 2019년 사업보고서를 통해 배당에 관한 사항을 살펴보도록 하겠습니다.</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="금융-데이터-수집하기-심화.html#cb519-1" aria-hidden="true" tabindex="-1"></a>corp_code <span class="ot">=</span> <span class="st">&#39;00126380&#39;</span></span>
<span id="cb519-2"><a href="금융-데이터-수집하기-심화.html#cb519-2" aria-hidden="true" tabindex="-1"></a>bsns_year <span class="ot">=</span> <span class="st">&#39;2019&#39;</span></span>
<span id="cb519-3"><a href="금융-데이터-수집하기-심화.html#cb519-3" aria-hidden="true" tabindex="-1"></a>reprt_code <span class="ot">=</span> <span class="st">&#39;11011&#39;</span></span>
<span id="cb519-4"><a href="금융-데이터-수집하기-심화.html#cb519-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb519-5"><a href="금융-데이터-수집하기-심화.html#cb519-5" aria-hidden="true" tabindex="-1"></a>url_div <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&#39;https://opendart.fss.or.kr/api/alotMatter.json?crtfc_key=&#39;</span>,</span>
<span id="cb519-6"><a href="금융-데이터-수집하기-심화.html#cb519-6" aria-hidden="true" tabindex="-1"></a>       dart_api, </span>
<span id="cb519-7"><a href="금융-데이터-수집하기-심화.html#cb519-7" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;&amp;corp_code=&#39;</span>, corp_code,</span>
<span id="cb519-8"><a href="금융-데이터-수집하기-심화.html#cb519-8" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;&amp;bsns_year=&#39;</span>, bsns_year,</span>
<span id="cb519-9"><a href="금융-데이터-수집하기-심화.html#cb519-9" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;&amp;reprt_code=&#39;</span>, reprt_code</span>
<span id="cb519-10"><a href="금융-데이터-수집하기-심화.html#cb519-10" aria-hidden="true" tabindex="-1"></a>       )</span></code></pre></div>
<p>API 인증키, 고유번호, 사업년도, 보고서 코드에 각각 해당하는 데이터를 입력하여 url 생성하도록 합니다.</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="금융-데이터-수집하기-심화.html#cb520-1" aria-hidden="true" tabindex="-1"></a>div_data_ss <span class="ot">=</span> <span class="fu">fromJSON</span>(url_div) </span>
<span id="cb520-2"><a href="금융-데이터-수집하기-심화.html#cb520-2" aria-hidden="true" tabindex="-1"></a>div_data_ss <span class="ot">=</span> div_data_ss[[<span class="st">&#39;list&#39;</span>]]</span>
<span id="cb520-3"><a href="금융-데이터-수집하기-심화.html#cb520-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-4"><a href="금융-데이터-수집하기-심화.html#cb520-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(div_data_ss)</span></code></pre></div>
<pre><code>##         rcept_no corp_cls corp_code corp_name                       se
## 1 20200330003851        Y  00126380  삼성전자         주당액면가액(원)
## 2 20200330003851        Y  00126380  삼성전자 (연결)당기순이익(백만원)
## 3 20200330003851        Y  00126380  삼성전자 (별도)당기순이익(백만원)
## 4 20200330003851        Y  00126380  삼성전자     (연결)주당순이익(원)
## 5 20200330003851        Y  00126380  삼성전자   현금배당금총액(백만원)
## 6 20200330003851        Y  00126380  삼성전자   주식배당금총액(백만원)
##       thstrm     frmtrm       lwfr stock_knd
## 1        100        100        100      &lt;NA&gt;
## 2 21,505,054 43,890,877 41,344,569      &lt;NA&gt;
## 3 15,353,323 32,815,127 28,800,837      &lt;NA&gt;
## 4      3,166      6,461      5,997      &lt;NA&gt;
## 5  9,619,243  9,619,243  5,826,302      &lt;NA&gt;
## 6          -          -          -      &lt;NA&gt;</code></pre>
<p>JSON 파일을 다운로드 받은 후 데이터를 확인해보면, 사업보고서 중 배당에 관한 사항만이 나타나 있습니다. 위 url의 <strong>alotMatter</strong> 부분을 각 사업보고서에 해당하는 값으로 변경해주면 다른 정보 역시 동일한 방법으로 수집이 가능합니다.</p>
</div>
<div id="상장기업-재무정보" class="section level3" number="6.3.5">
<h3><span class="header-section-number">6.3.5</span> 상장기업 재무정보</h3>
<p>Open API에서는 상장기업의 재무정보 중 주요계정, 전체 재무제표, 원본파일을 제공하고 있습니다. 이 중 주요계정 및 전체 재무제표를 다운로드 받는법에 대해 알아보도록 하겠습니다.</p>
<div id="단일회사-및-다중회사-주요계정" class="section level4" number="6.3.5.1">
<h4><span class="header-section-number">6.3.5.1</span> 단일회사 및 다중회사 주요계정</h4>
<p>API를 통해 단일회사의 주요계정을, 혹은 한번에 여러 회사의 주요계정을 받을수 있습니다. 각각의 개발가이드는 다음과 같습니다.</p>
<ul>
<li>단일회사 주요계정: <a href="https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS003&amp;apiId=2019016" class="uri">https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS003&amp;apiId=2019016</a></li>
<li>다중회사 주요계정: <a href="https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS003&amp;apiId=2019017" class="uri">https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS003&amp;apiId=2019017</a></li>
</ul>
<p>먼저 단일회사(삼성전자)의 주요계정을 다운로드 받도록 하겠습니다.</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="금융-데이터-수집하기-심화.html#cb522-1" aria-hidden="true" tabindex="-1"></a>corp_code <span class="ot">=</span> <span class="st">&#39;00126380&#39;</span></span>
<span id="cb522-2"><a href="금융-데이터-수집하기-심화.html#cb522-2" aria-hidden="true" tabindex="-1"></a>bsns_year <span class="ot">=</span> <span class="st">&#39;2019&#39;</span></span>
<span id="cb522-3"><a href="금융-데이터-수집하기-심화.html#cb522-3" aria-hidden="true" tabindex="-1"></a>reprt_code <span class="ot">=</span> <span class="st">&#39;11011&#39;</span></span>
<span id="cb522-4"><a href="금융-데이터-수집하기-심화.html#cb522-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb522-5"><a href="금융-데이터-수집하기-심화.html#cb522-5" aria-hidden="true" tabindex="-1"></a>url_single <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb522-6"><a href="금융-데이터-수집하기-심화.html#cb522-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;https://opendart.fss.or.kr/api/fnlttSinglAcnt.json?crtfc_key=&#39;</span>,</span>
<span id="cb522-7"><a href="금융-데이터-수집하기-심화.html#cb522-7" aria-hidden="true" tabindex="-1"></a>  dart_api, </span>
<span id="cb522-8"><a href="금융-데이터-수집하기-심화.html#cb522-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;&amp;corp_code=&#39;</span>, corp_code,</span>
<span id="cb522-9"><a href="금융-데이터-수집하기-심화.html#cb522-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;&amp;bsns_year=&#39;</span>, bsns_year,</span>
<span id="cb522-10"><a href="금융-데이터-수집하기-심화.html#cb522-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;&amp;reprt_code=&#39;</span>, reprt_code</span>
<span id="cb522-11"><a href="금융-데이터-수집하기-심화.html#cb522-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>url을 생성하는 방법이 기존 <a href="금융-데이터-수집하기-심화.html#사업보고서-주요-정보">사업보고서 주요 정보</a> 에서 살펴본 바와 매우 비슷하며, <strong>/api</strong> 뒷부분을 [fnlttSinglAcnt.json] 으로 변경하기만 하면 됩니다.</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="금융-데이터-수집하기-심화.html#cb523-1" aria-hidden="true" tabindex="-1"></a>fs_data_single <span class="ot">=</span> <span class="fu">fromJSON</span>(url_single) </span>
<span id="cb523-2"><a href="금융-데이터-수집하기-심화.html#cb523-2" aria-hidden="true" tabindex="-1"></a>fs_data_single <span class="ot">=</span> fs_data_single[[<span class="st">&#39;list&#39;</span>]]</span>
<span id="cb523-3"><a href="금융-데이터-수집하기-심화.html#cb523-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb523-4"><a href="금융-데이터-수집하기-심화.html#cb523-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fs_data_single)</span></code></pre></div>
<pre><code>##         rcept_no reprt_code bsns_year corp_code stock_code fs_div        fs_nm
## 1 20200330003851      11011      2019  00126380     005930    CFS 연결재무제표
## 2 20200330003851      11011      2019  00126380     005930    CFS 연결재무제표
## 3 20200330003851      11011      2019  00126380     005930    CFS 연결재무제표
## 4 20200330003851      11011      2019  00126380     005930    CFS 연결재무제표
## 5 20200330003851      11011      2019  00126380     005930    CFS 연결재무제표
## 6 20200330003851      11011      2019  00126380     005930    CFS 연결재무제표
##   sj_div      sj_nm account_nm thstrm_nm       thstrm_dt       thstrm_amount
## 1     BS 재무상태표   유동자산  제 51 기 2019.12.31 현재 181,385,260,000,000
## 2     BS 재무상태표 비유동자산  제 51 기 2019.12.31 현재 171,179,237,000,000
## 3     BS 재무상태표   자산총계  제 51 기 2019.12.31 현재 352,564,497,000,000
## 4     BS 재무상태표   유동부채  제 51 기 2019.12.31 현재  63,782,764,000,000
## 5     BS 재무상태표 비유동부채  제 51 기 2019.12.31 현재  25,901,312,000,000
## 6     BS 재무상태표   부채총계  제 51 기 2019.12.31 현재  89,684,076,000,000
##   frmtrm_nm       frmtrm_dt       frmtrm_amount bfefrmtrm_nm    bfefrmtrm_dt
## 1  제 50 기 2018.12.31 현재 174,697,424,000,000     제 49 기 2017.12.31 현재
## 2  제 50 기 2018.12.31 현재 164,659,820,000,000     제 49 기 2017.12.31 현재
## 3  제 50 기 2018.12.31 현재 339,357,244,000,000     제 49 기 2017.12.31 현재
## 4  제 50 기 2018.12.31 현재  69,081,510,000,000     제 49 기 2017.12.31 현재
## 5  제 50 기 2018.12.31 현재  22,522,557,000,000     제 49 기 2017.12.31 현재
## 6  제 50 기 2018.12.31 현재  91,604,067,000,000     제 49 기 2017.12.31 현재
##      bfefrmtrm_amount ord
## 1 146,982,464,000,000   1
## 2 154,769,626,000,000   3
## 3 301,752,090,000,000   5
## 4  67,175,114,000,000   7
## 5  20,085,548,000,000   9
## 6  87,260,662,000,000  11</code></pre>
<p>연결재무제표와 재무상태표에 해당하는 주요 내용이 수집되었으며, 각 열에 해당하는 내용은 페이지의 개발가이드의 [응답 결과]에서 확인할 수 있습니다.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-336"></span>
<img src="images/dart_single_result.png" alt="단일회사 주요계정 응답 결과" width="100%" />
<p class="caption">
그림 6.9: 단일회사 주요계정 응답 결과
</p>
</div>
<p>이번에는 url을 수정하여 여러 회사의 주요계정을 한번에 받도록 하겠으며, 그 예로써 삼성전자, 셀트리온, KT의 데이터를 다운로드 받도록 합니다.</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="금융-데이터-수집하기-심화.html#cb525-1" aria-hidden="true" tabindex="-1"></a>corp_code <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;00126380,00413046,00190321&#39;</span>)</span>
<span id="cb525-2"><a href="금융-데이터-수집하기-심화.html#cb525-2" aria-hidden="true" tabindex="-1"></a>bsns_year <span class="ot">=</span> <span class="st">&#39;2019&#39;</span></span>
<span id="cb525-3"><a href="금융-데이터-수집하기-심화.html#cb525-3" aria-hidden="true" tabindex="-1"></a>reprt_code <span class="ot">=</span> <span class="st">&#39;11011&#39;</span></span>
<span id="cb525-4"><a href="금융-데이터-수집하기-심화.html#cb525-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb525-5"><a href="금융-데이터-수집하기-심화.html#cb525-5" aria-hidden="true" tabindex="-1"></a>url_multiple <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb525-6"><a href="금융-데이터-수집하기-심화.html#cb525-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;https://opendart.fss.or.kr/api/fnlttMultiAcnt.json?crtfc_key=&#39;</span>,</span>
<span id="cb525-7"><a href="금융-데이터-수집하기-심화.html#cb525-7" aria-hidden="true" tabindex="-1"></a>  dart_api, </span>
<span id="cb525-8"><a href="금융-데이터-수집하기-심화.html#cb525-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;&amp;corp_code=&#39;</span>, corp_code,</span>
<span id="cb525-9"><a href="금융-데이터-수집하기-심화.html#cb525-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;&amp;bsns_year=&#39;</span>, bsns_year,</span>
<span id="cb525-10"><a href="금융-데이터-수집하기-심화.html#cb525-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;&amp;reprt_code=&#39;</span>, reprt_code</span>
<span id="cb525-11"><a href="금융-데이터-수집하기-심화.html#cb525-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>먼저 corp에 원하는 기업들의 고유번호를 나열해주며, url 중 [fnlttSinglAcnt]을 [fnlttMultiAcnt]로 수정합니다.</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="금융-데이터-수집하기-심화.html#cb526-1" aria-hidden="true" tabindex="-1"></a>fs_data_multiple <span class="ot">=</span> <span class="fu">fromJSON</span>(url_multiple) </span>
<span id="cb526-2"><a href="금융-데이터-수집하기-심화.html#cb526-2" aria-hidden="true" tabindex="-1"></a>fs_data_multiple <span class="ot">=</span> fs_data_multiple[[<span class="st">&#39;list&#39;</span>]]</span></code></pre></div>
<p>3개 기업의 주요계정이 하나의 데이터 프레임으로 다운로드 됩니다. 마지막으로 각 회사별로 데이터를 나눠주도록 하겠습니다.</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="금융-데이터-수집하기-심화.html#cb527-1" aria-hidden="true" tabindex="-1"></a>fs_data_list <span class="ot">=</span> fs_data_multiple <span class="sc">%&gt;%</span> <span class="fu">split</span>(<span class="at">f =</span> .<span class="sc">$</span>corp_code)</span>
<span id="cb527-2"><a href="금융-데이터-수집하기-심화.html#cb527-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb527-3"><a href="금융-데이터-수집하기-심화.html#cb527-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(fs_data_list, head, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## $`00126380`
##         rcept_no reprt_code bsns_year corp_code stock_code fs_div        fs_nm
## 1 20200330003851      11011      2019  00126380     005930    CFS 연결재무제표
## 2 20200330003851      11011      2019  00126380     005930    CFS 연결재무제표
##   sj_div      sj_nm account_nm thstrm_nm       thstrm_dt       thstrm_amount
## 1     BS 재무상태표   유동자산  제 51 기 2019.12.31 현재 181,385,260,000,000
## 2     BS 재무상태표 비유동자산  제 51 기 2019.12.31 현재 171,179,237,000,000
##   frmtrm_nm       frmtrm_dt       frmtrm_amount bfefrmtrm_nm    bfefrmtrm_dt
## 1  제 50 기 2018.12.31 현재 174,697,424,000,000     제 49 기 2017.12.31 현재
## 2  제 50 기 2018.12.31 현재 164,659,820,000,000     제 49 기 2017.12.31 현재
##      bfefrmtrm_amount ord
## 1 146,982,464,000,000   1
## 2 154,769,626,000,000   3
## 
## $`00190321`
##          rcept_no reprt_code bsns_year corp_code stock_code fs_div        fs_nm
## 27 20200330004658      11011      2019  00190321     030200    CFS 연결재무제표
## 28 20200330004658      11011      2019  00190321     030200    CFS 연결재무제표
##    sj_div      sj_nm account_nm thstrm_nm       thstrm_dt      thstrm_amount
## 27     BS 재무상태표   유동자산  제 38 기 2019.12.31 현재 11,898,255,000,000
## 28     BS 재무상태표 비유동자산  제 38 기 2019.12.31 현재 22,163,037,000,000
##    frmtrm_nm       frmtrm_dt      frmtrm_amount bfefrmtrm_nm    bfefrmtrm_dt
## 27  제 37 기 2018.12.31 현재 11,894,252,000,000     제 36 기 2017.12.31 현재
## 28  제 37 기 2018.12.31 현재 20,294,578,000,000     제 36 기 2017.12.31 현재
##      bfefrmtrm_amount ord
## 27  9,672,412,000,000   1
## 28 20,058,498,000,000   3
## 
## $`00413046`
##          rcept_no reprt_code bsns_year corp_code stock_code fs_div        fs_nm
## 53 20200410002837      11011      2019  00413046     068270    CFS 연결재무제표
## 54 20200410002837      11011      2019  00413046     068270    CFS 연결재무제표
##    sj_div      sj_nm account_nm thstrm_nm       thstrm_dt     thstrm_amount
## 53     BS 재무상태표   유동자산  제 29 기 2019.12.31 현재 1,787,340,254,600
## 54     BS 재무상태표 비유동자산  제 29 기 2019.12.31 현재 2,106,351,351,846
##    frmtrm_nm       frmtrm_dt     frmtrm_amount bfefrmtrm_nm    bfefrmtrm_dt
## 53  제 28 기 2018.12.31 현재 1,664,478,918,682     제 27 기 2017.12.31 현재
## 54  제 28 기 2018.12.31 현재 1,876,147,755,272     제 27 기 2017.12.31 현재
##     bfefrmtrm_amount ord
## 53 1,614,033,788,024   1
## 54 1,701,493,916,629   3</code></pre>
<p><code>split()</code> 함수 내 f 인자를 통해 corp_code, 즉 고유번호 단위로 각각의 리스트에 데이터가 저장됩니다.</p>
</div>
</div>
<div id="단일회사-전체-재무제표" class="section level3" number="6.3.6">
<h3><span class="header-section-number">6.3.6</span> 단일회사 전체 재무제표</h3>
<p>단일회사의 전체 재무제표 데이터 역시 다운로드 받을 수 있으며 개발가이드는 다음과 같습니다.</p>
<p><a href="https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS003&amp;apiId=2019020" class="uri">https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS003&amp;apiId=2019020</a></p>
<p>예제로써 삼성전자의 2019년 사업보고서에 나와있는 전체 재무제표를 다운로드 받도록 하겠습니다.</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="금융-데이터-수집하기-심화.html#cb529-1" aria-hidden="true" tabindex="-1"></a>corp_code <span class="ot">=</span> <span class="st">&#39;00126380&#39;</span></span>
<span id="cb529-2"><a href="금융-데이터-수집하기-심화.html#cb529-2" aria-hidden="true" tabindex="-1"></a>bsns_year <span class="ot">=</span> <span class="dv">2019</span></span>
<span id="cb529-3"><a href="금융-데이터-수집하기-심화.html#cb529-3" aria-hidden="true" tabindex="-1"></a>reprt_code <span class="ot">=</span> <span class="st">&#39;11011&#39;</span></span>
<span id="cb529-4"><a href="금융-데이터-수집하기-심화.html#cb529-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb529-5"><a href="금융-데이터-수집하기-심화.html#cb529-5" aria-hidden="true" tabindex="-1"></a>url_fs_all <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb529-6"><a href="금융-데이터-수집하기-심화.html#cb529-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;https://opendart.fss.or.kr/api/fnlttSinglAcntAll.json?crtfc_key=&#39;</span>,</span>
<span id="cb529-7"><a href="금융-데이터-수집하기-심화.html#cb529-7" aria-hidden="true" tabindex="-1"></a>   dart_api, </span>
<span id="cb529-8"><a href="금융-데이터-수집하기-심화.html#cb529-8" aria-hidden="true" tabindex="-1"></a>   <span class="st">&#39;&amp;corp_code=&#39;</span>, corp_code,</span>
<span id="cb529-9"><a href="금융-데이터-수집하기-심화.html#cb529-9" aria-hidden="true" tabindex="-1"></a>   <span class="st">&#39;&amp;bsns_year=&#39;</span>, bsns_year,</span>
<span id="cb529-10"><a href="금융-데이터-수집하기-심화.html#cb529-10" aria-hidden="true" tabindex="-1"></a>   <span class="st">&#39;&amp;reprt_code=&#39;</span>, reprt_code,<span class="st">&#39;&amp;fs_div=CFS&#39;</span></span>
<span id="cb529-11"><a href="금융-데이터-수집하기-심화.html#cb529-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>역시나 앞선 예제들과 거의 동일화며, url의 <strong>api/</strong> 뒷 부분을 [fnlttSinglAcntAll.json] 으로 변경해주도록 합니다. 연결재무제표와 일반재무제표를 구분하는 fs_div 인자는 연결재무제표를 의미하는 CFS로 선택해줍니다.</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="금융-데이터-수집하기-심화.html#cb530-1" aria-hidden="true" tabindex="-1"></a>fs_data_all <span class="ot">=</span> <span class="fu">fromJSON</span>(url_fs_all) </span>
<span id="cb530-2"><a href="금융-데이터-수집하기-심화.html#cb530-2" aria-hidden="true" tabindex="-1"></a>fs_data_all <span class="ot">=</span> fs_data_all[[<span class="st">&#39;list&#39;</span>]]</span>
<span id="cb530-3"><a href="금융-데이터-수집하기-심화.html#cb530-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb530-4"><a href="금융-데이터-수집하기-심화.html#cb530-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fs_data_all)</span></code></pre></div>
<pre><code>##         rcept_no reprt_code bsns_year corp_code sj_div      sj_nm
## 1 20200330003851      11011      2019  00126380     BS 재무상태표
## 2 20200330003851      11011      2019  00126380     BS 재무상태표
## 3 20200330003851      11011      2019  00126380     BS 재무상태표
## 4 20200330003851      11011      2019  00126380     BS 재무상태표
## 5 20200330003851      11011      2019  00126380     BS 재무상태표
## 6 20200330003851      11011      2019  00126380     BS 재무상태표
##                                                                                     account_id
## 1                                                                      ifrs-full_CurrentAssets
## 2                                                             ifrs-full_CashAndCashEquivalents
## 3                                         dart_ShortTermDepositsNotClassifiedAsCashEquivalents
## 4                                                                        -표준계정코드 미사용-
## 5                                                                        -표준계정코드 미사용-
## 6 ifrs-full_CurrentFinancialAssetsAtFairValueThroughProfitOrLossMandatorilyMeasuredAtFairValue
##                      account_nm account_detail thstrm_nm   thstrm_amount
## 1                      유동자산              -  제 51 기 181385260000000
## 2              현금및현금성자산              -  제 51 기  26885999000000
## 3                  단기금융상품              -  제 51 기  76252052000000
## 4          단기매도가능금융자산              -  제 51 기                
## 5        단기상각후원가금융자산              -  제 51 기   3914216000000
## 6 단기당기손익-공정가치금융자산              -  제 51 기   1727436000000
##   frmtrm_nm   frmtrm_amount bfefrmtrm_nm bfefrmtrm_amount ord thstrm_add_amount
## 1  제 50 기 174697424000000     제 49 기  146982464000000   1              &lt;NA&gt;
## 2  제 50 기  30340505000000     제 49 기   30545130000000   2              &lt;NA&gt;
## 3  제 50 기  65893797000000     제 49 기   49447696000000   3              &lt;NA&gt;
## 4  제 50 기                     제 49 기    3191375000000   4              &lt;NA&gt;
## 5  제 50 기   2703693000000     제 49 기                    5              &lt;NA&gt;
## 6  제 50 기   2001948000000     제 49 기                    6              &lt;NA&gt;</code></pre>
<p>총 210개의 재무제표 항목이 다운로드 됩니다. 이 중 thstrm_nm와 thstrm_amount는 당기(금년), frmtrm_nm과 frmtrm_amount는 전기, bfefrmtrm_nm과 bfefrmtrm_amount는 전전기를 의미합니다. 따라서 해당 열을 통해 최근 3년 재무제표 만을 선택할 수도 있습니다.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="금융-데이터-수집하기-심화.html#cb532-1" aria-hidden="true" tabindex="-1"></a>yr_count <span class="ot">=</span> <span class="fu">str_detect</span>(<span class="fu">colnames</span>(fs_data_all), <span class="st">&#39;trm_amount&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">sum</span>()</span>
<span id="cb532-2"><a href="금융-데이터-수집하기-심화.html#cb532-2" aria-hidden="true" tabindex="-1"></a>yr_name <span class="ot">=</span> <span class="fu">seq</span>(bsns_year, (bsns_year <span class="sc">-</span> yr_count <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb532-3"><a href="금융-데이터-수집하기-심화.html#cb532-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-4"><a href="금융-데이터-수집하기-심화.html#cb532-4" aria-hidden="true" tabindex="-1"></a>fs_data_all <span class="ot">=</span> fs_data_all[, <span class="fu">c</span>(<span class="st">&#39;corp_code&#39;</span>, <span class="st">&#39;sj_nm&#39;</span>, <span class="st">&#39;account_nm&#39;</span>, <span class="st">&#39;account_detail&#39;</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb532-5"><a href="금융-데이터-수집하기-심화.html#cb532-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(fs_data_all[, <span class="fu">str_which</span>(<span class="fu">colnames</span>(fs_data_all), <span class="st">&#39;trm_amount&#39;</span>)])</span>
<span id="cb532-6"><a href="금융-데이터-수집하기-심화.html#cb532-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-7"><a href="금융-데이터-수집하기-심화.html#cb532-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(fs_data_all)[<span class="fu">str_which</span>(<span class="fu">colnames</span>(fs_data_all), <span class="st">&#39;amount&#39;</span>)] <span class="ot">=</span> yr_name</span>
<span id="cb532-8"><a href="금융-데이터-수집하기-심화.html#cb532-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-9"><a href="금융-데이터-수집하기-심화.html#cb532-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fs_data_all)</span></code></pre></div>
<pre><code>##   corp_code      sj_nm                    account_nm account_detail
## 1  00126380 재무상태표                      유동자산              -
## 2  00126380 재무상태표              현금및현금성자산              -
## 3  00126380 재무상태표                  단기금융상품              -
## 4  00126380 재무상태표          단기매도가능금융자산              -
## 5  00126380 재무상태표        단기상각후원가금융자산              -
## 6  00126380 재무상태표 단기당기손익-공정가치금융자산              -
##              2019            2018            2017
## 1 181385260000000 174697424000000 146982464000000
## 2  26885999000000  30340505000000  30545130000000
## 3  76252052000000  65893797000000  49447696000000
## 4                                   3191375000000
## 5   3914216000000   2703693000000                
## 6   1727436000000   2001948000000</code></pre>
<ol style="list-style-type: decimal">
<li><code>str_detect()</code> 함수를 이용해 열 이름에 trm_amount 들어간 갯수를 확인합니다. 이는 최근 3개년 데이터가 없는 경우도 고려하기 위함입니다. (일반적으로 3이 반환될 것이며, 재무데이터가 2년치 밖에 없는 경우 2가 반환될 것입니다.)</li>
<li>위에서 계산된 갯수를 이용해 열이름에 들어갈 년도를 생성합니다.</li>
<li>corp_code(고유번호), sj_nm(재무제표명), account_nm(계정명), account_detail(계정상세) 및 연도별 금액에 해당하는 trm_amount가 포함된 열을 선택합니다.</li>
<li>연도별 데이터에 해당하는 열의 이름을 yr_name, 즉 각 연도로 변경합니다.</li>
</ol>
<div id="전-종목-전체-재무제표-데이터-수집하기" class="section level4" number="6.3.6.1">
<h4><span class="header-section-number">6.3.6.1</span> 전 종목 전체 재무제표 데이터 수집하기</h4>
<p>for loop 구문을 이용해 고유번호에 해당하는 corp_code 부분만 변경해주면 전 종목의 API를 통해 재무제표 데이터를 손쉽게 수집할 수도 있습니다. 단, 일부 종목(대부분 금융주)의 경우 API로 파일이 제공되지 않습니다.</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="금융-데이터-수집하기-심화.html#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb534-2"><a href="금융-데이터-수집하기-심화.html#cb534-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb534-3"><a href="금융-데이터-수집하기-심화.html#cb534-3" aria-hidden="true" tabindex="-1"></a>KOR_ticker <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&#39;data/KOR_ticker.csv&#39;</span>, <span class="at">row.names =</span> <span class="dv">1</span>)</span>
<span id="cb534-4"><a href="금융-데이터-수집하기-심화.html#cb534-4" aria-hidden="true" tabindex="-1"></a>corp_list <span class="ot">=</span>  <span class="fu">read.csv</span>(<span class="st">&#39;data/corp_list.csv&#39;</span>, <span class="at">row.names =</span> <span class="dv">1</span>)</span>
<span id="cb534-5"><a href="금융-데이터-수집하기-심화.html#cb534-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb534-6"><a href="금융-데이터-수집하기-심화.html#cb534-6" aria-hidden="true" tabindex="-1"></a>KOR_ticker<span class="sc">$</span><span class="st">&#39;종목코드&#39;</span> <span class="ot">=</span></span>
<span id="cb534-7"><a href="금융-데이터-수집하기-심화.html#cb534-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_pad</span>(KOR_ticker<span class="sc">$</span><span class="st">&#39;종목코드&#39;</span>, <span class="dv">6</span>, <span class="at">side =</span> <span class="fu">c</span>(<span class="st">&#39;left&#39;</span>), <span class="at">pad =</span> <span class="st">&#39;0&#39;</span>)</span>
<span id="cb534-8"><a href="금융-데이터-수집하기-심화.html#cb534-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb534-9"><a href="금융-데이터-수집하기-심화.html#cb534-9" aria-hidden="true" tabindex="-1"></a>corp_list<span class="sc">$</span><span class="st">&#39;code&#39;</span> <span class="ot">=</span></span>
<span id="cb534-10"><a href="금융-데이터-수집하기-심화.html#cb534-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_pad</span>(corp_list<span class="sc">$</span><span class="st">&#39;code&#39;</span>, <span class="dv">8</span>, <span class="at">side =</span> <span class="fu">c</span>(<span class="st">&#39;left&#39;</span>), <span class="at">pad =</span> <span class="st">&#39;0&#39;</span>)</span>
<span id="cb534-11"><a href="금융-데이터-수집하기-심화.html#cb534-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb534-12"><a href="금융-데이터-수집하기-심화.html#cb534-12" aria-hidden="true" tabindex="-1"></a>corp_list<span class="sc">$</span><span class="st">&#39;stock&#39;</span> <span class="ot">=</span></span>
<span id="cb534-13"><a href="금융-데이터-수집하기-심화.html#cb534-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_pad</span>(corp_list<span class="sc">$</span><span class="st">&#39;stock&#39;</span>, <span class="dv">6</span>, <span class="at">side =</span> <span class="fu">c</span>(<span class="st">&#39;left&#39;</span>), <span class="at">pad =</span> <span class="st">&#39;0&#39;</span>)</span>
<span id="cb534-14"><a href="금융-데이터-수집하기-심화.html#cb534-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb534-15"><a href="금융-데이터-수집하기-심화.html#cb534-15" aria-hidden="true" tabindex="-1"></a>ticker_list <span class="ot">=</span> KOR_ticker <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(corp_list, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;종목코드&#39;</span> <span class="ot">=</span> <span class="st">&#39;stock&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb534-16"><a href="금융-데이터-수집하기-심화.html#cb534-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">&#39;종목코드&#39;</span>, <span class="st">&#39;종목명&#39;</span>, <span class="st">&#39;code&#39;</span>)</span>
<span id="cb534-17"><a href="금융-데이터-수집하기-심화.html#cb534-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb534-18"><a href="금융-데이터-수집하기-심화.html#cb534-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">dir.exists</span>(<span class="st">&#39;data/dart_fs&#39;</span>), <span class="cn">FALSE</span>, <span class="fu">dir.create</span>(<span class="st">&#39;data/dart_fs&#39;</span>))</span></code></pre></div>
<p>먼저 거래소에서 받은 티커 파일과 API를 통해 받은 고유번호 파일을 불러온 후, <code>str_pad()</code> 함수를 통해 0을 채워주며, 고유번호의 경우 8자리로 구성되어 있습니다. 그 후 dart_fs 폴더를 생성해 줍니다.</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="금융-데이터-수집하기-심화.html#cb535-1" aria-hidden="true" tabindex="-1"></a>bsns_year <span class="ot">=</span> <span class="dv">2019</span></span>
<span id="cb535-2"><a href="금융-데이터-수집하기-심화.html#cb535-2" aria-hidden="true" tabindex="-1"></a>reprt_code <span class="ot">=</span> <span class="st">&#39;11011&#39;</span></span>
<span id="cb535-3"><a href="금융-데이터-수집하기-심화.html#cb535-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb535-4"><a href="금융-데이터-수집하기-심화.html#cb535-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> <span class="fu">nrow</span>(ticker_list) ) {</span>
<span id="cb535-5"><a href="금융-데이터-수집하기-심화.html#cb535-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb535-6"><a href="금융-데이터-수집하기-심화.html#cb535-6" aria-hidden="true" tabindex="-1"></a>  data_fs <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb535-7"><a href="금융-데이터-수집하기-심화.html#cb535-7" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">=</span> ticker_list<span class="sc">$</span>code[i]</span>
<span id="cb535-8"><a href="금융-데이터-수집하기-심화.html#cb535-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb535-9"><a href="금융-데이터-수집하기-심화.html#cb535-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 오류 발생 시 이를 무시하고 다음 루프로 진행</span></span>
<span id="cb535-10"><a href="금융-데이터-수집하기-심화.html#cb535-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb535-11"><a href="금융-데이터-수집하기-심화.html#cb535-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb535-12"><a href="금융-데이터-수집하기-심화.html#cb535-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb535-13"><a href="금융-데이터-수집하기-심화.html#cb535-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># url 생성</span></span>
<span id="cb535-14"><a href="금융-데이터-수집하기-심화.html#cb535-14" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&#39;https://opendart.fss.or.kr/api/fnlttSinglAcntAll.json?crtfc_key=&#39;</span>,</span>
<span id="cb535-15"><a href="금융-데이터-수집하기-심화.html#cb535-15" aria-hidden="true" tabindex="-1"></a>       dart_api, </span>
<span id="cb535-16"><a href="금융-데이터-수집하기-심화.html#cb535-16" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;&amp;corp_code=&#39;</span>, name,</span>
<span id="cb535-17"><a href="금융-데이터-수집하기-심화.html#cb535-17" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;&amp;bsns_year=&#39;</span>, bsns_year,</span>
<span id="cb535-18"><a href="금융-데이터-수집하기-심화.html#cb535-18" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;&amp;reprt_code=&#39;</span>, reprt_code,<span class="st">&#39;&amp;fs_div=CFS&#39;</span></span>
<span id="cb535-19"><a href="금융-데이터-수집하기-심화.html#cb535-19" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb535-20"><a href="금융-데이터-수집하기-심화.html#cb535-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb535-21"><a href="금융-데이터-수집하기-심화.html#cb535-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># JSON 다운로드</span></span>
<span id="cb535-22"><a href="금융-데이터-수집하기-심화.html#cb535-22" aria-hidden="true" tabindex="-1"></a>    fs_data_all <span class="ot">=</span> <span class="fu">fromJSON</span>(url) </span>
<span id="cb535-23"><a href="금융-데이터-수집하기-심화.html#cb535-23" aria-hidden="true" tabindex="-1"></a>    fs_data_all <span class="ot">=</span> fs_data_all[[<span class="st">&#39;list&#39;</span>]]</span>
<span id="cb535-24"><a href="금융-데이터-수집하기-심화.html#cb535-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb535-25"><a href="금융-데이터-수집하기-심화.html#cb535-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 만일 연결재무제표 없어서 NULL 반환시</span></span>
<span id="cb535-26"><a href="금융-데이터-수집하기-심화.html#cb535-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># reprt_code를 OFS 즉 재무제표 다운로드</span></span>
<span id="cb535-27"><a href="금융-데이터-수집하기-심화.html#cb535-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(fs_data_all)) {</span>
<span id="cb535-28"><a href="금융-데이터-수집하기-심화.html#cb535-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb535-29"><a href="금융-데이터-수집하기-심화.html#cb535-29" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&#39;https://opendart.fss.or.kr/api/fnlttSinglAcntAll.json?crtfc_key=&#39;</span>,</span>
<span id="cb535-30"><a href="금융-데이터-수집하기-심화.html#cb535-30" aria-hidden="true" tabindex="-1"></a>       dart_api, </span>
<span id="cb535-31"><a href="금융-데이터-수집하기-심화.html#cb535-31" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;&amp;corp_code=&#39;</span>, name,</span>
<span id="cb535-32"><a href="금융-데이터-수집하기-심화.html#cb535-32" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;&amp;bsns_year=&#39;</span>, bsns_year,</span>
<span id="cb535-33"><a href="금융-데이터-수집하기-심화.html#cb535-33" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;&amp;reprt_code=&#39;</span>, reprt_code,<span class="st">&#39;&amp;fs_div=OFS&#39;</span></span>
<span id="cb535-34"><a href="금융-데이터-수집하기-심화.html#cb535-34" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb535-35"><a href="금융-데이터-수집하기-심화.html#cb535-35" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb535-36"><a href="금융-데이터-수집하기-심화.html#cb535-36" aria-hidden="true" tabindex="-1"></a>      fs_data_all <span class="ot">=</span> <span class="fu">fromJSON</span>(url) </span>
<span id="cb535-37"><a href="금융-데이터-수집하기-심화.html#cb535-37" aria-hidden="true" tabindex="-1"></a>      fs_data_all <span class="ot">=</span> fs_data_all[[<span class="st">&#39;list&#39;</span>]]</span>
<span id="cb535-38"><a href="금융-데이터-수집하기-심화.html#cb535-38" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb535-39"><a href="금융-데이터-수집하기-심화.html#cb535-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb535-40"><a href="금융-데이터-수집하기-심화.html#cb535-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb535-41"><a href="금융-데이터-수집하기-심화.html#cb535-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb535-42"><a href="금융-데이터-수집하기-심화.html#cb535-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 데이터 선택 후 열이름을 연도로 변경</span></span>
<span id="cb535-43"><a href="금융-데이터-수집하기-심화.html#cb535-43" aria-hidden="true" tabindex="-1"></a>    yr_count <span class="ot">=</span> <span class="fu">str_detect</span>(<span class="fu">colnames</span>(fs_data_all), <span class="st">&#39;trm_amount&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">sum</span>()</span>
<span id="cb535-44"><a href="금융-데이터-수집하기-심화.html#cb535-44" aria-hidden="true" tabindex="-1"></a>    yr_name <span class="ot">=</span> <span class="fu">seq</span>(bsns_year, (bsns_year <span class="sc">-</span> yr_count <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb535-45"><a href="금융-데이터-수집하기-심화.html#cb535-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb535-46"><a href="금융-데이터-수집하기-심화.html#cb535-46" aria-hidden="true" tabindex="-1"></a>    fs_data_all <span class="ot">=</span> fs_data_all[, <span class="fu">c</span>(<span class="st">&#39;corp_code&#39;</span>, <span class="st">&#39;sj_nm&#39;</span>, <span class="st">&#39;account_nm&#39;</span>, <span class="st">&#39;account_detail&#39;</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb535-47"><a href="금융-데이터-수집하기-심화.html#cb535-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(fs_data_all[, <span class="fu">str_which</span>(<span class="fu">colnames</span>(fs_data_all), <span class="st">&#39;trm_amount&#39;</span>)])</span>
<span id="cb535-48"><a href="금융-데이터-수집하기-심화.html#cb535-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb535-49"><a href="금융-데이터-수집하기-심화.html#cb535-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(fs_data_all)[<span class="fu">str_which</span>(<span class="fu">colnames</span>(fs_data_all), <span class="st">&#39;amount&#39;</span>)] <span class="ot">=</span> yr_name</span>
<span id="cb535-50"><a href="금융-데이터-수집하기-심화.html#cb535-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb535-51"><a href="금융-데이터-수집하기-심화.html#cb535-51" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb535-52"><a href="금융-데이터-수집하기-심화.html#cb535-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb535-53"><a href="금융-데이터-수집하기-심화.html#cb535-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 오류 발생시 해당 종목명을 출력하고 다음 루프로 이동</span></span>
<span id="cb535-54"><a href="금융-데이터-수집하기-심화.html#cb535-54" aria-hidden="true" tabindex="-1"></a>    data_fs <span class="ot">&lt;&lt;-</span> <span class="cn">NA</span></span>
<span id="cb535-55"><a href="금융-데이터-수집하기-심화.html#cb535-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste0</span>(<span class="st">&quot;Error in Ticker: &quot;</span>, name))</span>
<span id="cb535-56"><a href="금융-데이터-수집하기-심화.html#cb535-56" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb535-57"><a href="금융-데이터-수집하기-심화.html#cb535-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb535-58"><a href="금융-데이터-수집하기-심화.html#cb535-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 다운로드 받은 파일을 생성한 각각의 폴더 내 csv 파일로 저장</span></span>
<span id="cb535-59"><a href="금융-데이터-수집하기-심화.html#cb535-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb535-60"><a href="금융-데이터-수집하기-심화.html#cb535-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 재무제표 저장</span></span>
<span id="cb535-61"><a href="금융-데이터-수집하기-심화.html#cb535-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(fs_data_all, <span class="fu">paste0</span>(<span class="st">&#39;data/dart_fs/&#39;</span>, ticker_list<span class="sc">$</span>종목코드[i], <span class="st">&#39;_fs_dart.csv&#39;</span>))</span>
<span id="cb535-62"><a href="금융-데이터-수집하기-심화.html#cb535-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb535-63"><a href="금융-데이터-수집하기-심화.html#cb535-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2초간 타임슬립 적용</span></span>
<span id="cb535-64"><a href="금융-데이터-수집하기-심화.html#cb535-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">2</span>)</span>
<span id="cb535-65"><a href="금융-데이터-수집하기-심화.html#cb535-65" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>for loop 구문을 이용해 고유번호에 해당하는 값을 변경합니다.</li>
<li>일부 종목의 경우 연결재무제표가 아닌 재무제표를 업로드 하는 경우가 있으며, <code>if (is.null(fs_data_all))</code> 부분을 통해 연결재무제표가 없을 경우 fs_div를 OFS로 변경하여 재무제표를 다운로드 받습니다.</li>
<li>이를 제외하고는 앞서 살펴본 예제와 동일합니다.</li>
<li>데이터 수집 및 정리를 해준 후, data 폴더의 dart_fs 폴더 내에 티커_fs_dart.csv 이름으로 저장해 줍니다.</li>
</ol>
<p>Open API 내에서는 2015년 이후 재무제표 데이터를 API 형태로 제공하고 있으므로 bsns_year 부분에도 for loop 구문을 이용하면 해당 데이터를 모두 수집할 수 있습니다. 그러나 간단한 퀀트 투자를 하기에는 최근 3년의 재무제표 데이터만 있어도 충분하며, 시간이 너무 오래 걸린다는 점, API 요청한도를 초과한다는 단점이 있으므로 본 책에서는 다루지 않도록 하겠습니다.</p>

</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="14">
<li id="fn14"><p><a href="https://finance.naver.com/item/fchart.nhn?code=005930" class="uri">https://finance.naver.com/item/fchart.nhn?code=005930</a><a href="금융-데이터-수집하기-심화.html#fnref14" class="footnote-back">↩︎</a></p></li>
<li id="fn15"><p><a href="http://comp.fnguide.com/" class="uri">http://comp.fnguide.com/</a><a href="금융-데이터-수집하기-심화.html#fnref15" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p>분모에 사용되는 재무데이터의 구체적인 항목과 발행주식수를 계산하는 방법의 차이로 인해 여러 업체에서 제공하는 가치지표와 다소 차이가 발생할 수 있습니다.<a href="금융-데이터-수집하기-심화.html#fnref16" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<div id="disqus_thread"></div>
<script>

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://quant-cookbook.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
            </section>

          </div>
        </div>
      </div>
<a href="금융-데이터-수집하기-기본.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="데이터-정리하기.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section"
},
"split_bib": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
